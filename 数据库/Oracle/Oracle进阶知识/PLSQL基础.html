<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>PLSQL基础 | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/27.10fbd948.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/25.0536eb3c.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/34.112b9f11.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/41.ef41848b.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/61.d314066d.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/91.0823b62f.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html" title="PLSQL基础" class="active sidebar-link">PLSQL基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql简介" title="PL/SQL简介" class="sidebar-link">PL/SQL简介</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql基础语法" title="PL/SQL基础语法" class="sidebar-link">PL/SQL基础语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql基本类型变量" title="PL/SQL基本类型变量" class="sidebar-link">PL/SQL基本类型变量</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql引用型变量" title="PL/SQL引用型变量" class="sidebar-link">PL/SQL引用型变量</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql记录型变量" title="PL/SQL记录型变量" class="sidebar-link">PL/SQL记录型变量</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql中的条件语句" title="PL/SQL中的条件语句" class="sidebar-link">PL/SQL中的条件语句</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql中的循环语句" title="PL/SQL中的循环语句" class="sidebar-link">PL/SQL中的循环语句</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#pl-sql光标" title="PL/SQL光标" class="sidebar-link">PL/SQL光标</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#定义光标" title="定义光标" class="sidebar-link">定义光标</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#使用光标" title="使用光标" class="sidebar-link">使用光标</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#光标的属性" title="光标的属性" class="sidebar-link">光标的属性</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#光标数限制" title="光标数限制" class="sidebar-link">光标数限制</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#带参数的光标" title="带参数的光标" class="sidebar-link">带参数的光标</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#例外-异常" title="例外（异常）" class="sidebar-link">例外（异常）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#系统例外的分类" title="系统例外的分类" class="sidebar-link">系统例外的分类</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/PLSQL基础.html#自定义例外" title="自定义例外" class="sidebar-link">自定义例外</a></li></ul></li></ul></li><li><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/存储过程和存储函数.html" title="存储过程和存储函数" class="sidebar-link">存储过程和存储函数</a></li><li><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/触发器.html" title="触发器" class="sidebar-link">触发器</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="pl-sql简介"><a href="#pl-sql简介" class="header-anchor">#</a> PL/SQL简介</h2> <p>PL/SQL是Oracle对SQL语言的过程化扩展，主要包含两个含义：</p> <ul><li>PL/SQL是Oracle对SQL语言的扩展</li> <li>PL/SQL是过程性语言</li></ul> <h2 id="pl-sql基础语法"><a href="#pl-sql基础语法" class="header-anchor">#</a> PL/SQL基础语法</h2> <h3 id="pl-sql基本类型变量"><a href="#pl-sql基本类型变量" class="header-anchor">#</a> PL/SQL基本类型变量</h3> <p>首先，我们来看一下PL/SQL的程序结构</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">declare</span>
  说明部分（变量说明、光标说明、例外说明）
<span class="token keyword">begin</span>
	语句序列（DML语句）
<span class="token keyword">exception</span>
   例外处理语句
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>在PL/SQL中可以定义基本类型：<code>char</code>、<code>varchar2</code>、<code>date</code>、<code>number</code>、<code>boolean</code>、<code>long</code>这几种变量类型。另外，需要注意的是在PL\SQL中基本类型变量使用<code>:=</code>对变量进行赋值，且变量名在前，变量类型在后。下面来举一个例子：</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">declare</span> 
 pnumber number<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 pname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 pdate <span class="token keyword">date</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span> 
 pnumber <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pnumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
 pname <span class="token operator">:=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pname<span class="token punctuation">)</span><span class="token punctuation">;</span>
 pdate <span class="token operator">:=</span> sysdate<span class="token punctuation">;</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">-- 计算明天的日期</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pdate<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pl-sql引用型变量"><a href="#pl-sql引用型变量" class="header-anchor">#</a> PL/SQL引用型变量</h3> <p>PL/SQL引用型变量可以按如下方式定义：</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code>变量名 引用<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
</code></pre></div><p>举个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>my_name emp.name%type;
</code></pre></div><p>上面的意思是my_name变量使用emp表name字段的类型作为自己的变量类型。如果emp.name是字符串变量，则my_name变量是字符串变量。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">declare</span>
 <span class="token comment">-- 定义引用型变量</span>
  	pename emp<span class="token punctuation">.</span><span class="token keyword">name</span><span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
  	psal emp<span class="token punctuation">.</span>sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
 <span class="token keyword">begin</span>
 <span class="token comment">-- 得到7839的姓名和薪水</span>
 	<span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">into</span> pename<span class="token punctuation">,</span>psal <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token number">7839</span><span class="token punctuation">;</span>
 <span class="token comment">-- 打印姓名和薪水</span>
 	dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pename <span class="token operator">||</span><span class="token string">'的薪水是'</span> <span class="token operator">||</span> psal<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的SQL中，我们使用<code>into</code>关键字将查询到的数据赋值给pename,psal这两个变量。需要注意的是，pename,psal顺序和ename,sal变量的顺序需要一一对应。</p> <h3 id="pl-sql记录型变量"><a href="#pl-sql记录型变量" class="header-anchor">#</a> PL/SQL记录型变量</h3> <p>和引用型变量比较相似的是记录型变量，其定义如下：</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code>变量名 表名<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
</code></pre></div><p>这句话的意思就是，我取这一张表中一行的类型作为这个变量，</p> <p>举个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>emp_rec emp%rowtype;
</code></pre></div><p>在一张表中有多个列，因此可以把记录型变量看成是一个数组。如果我们需要引用其中的某一列，则我们可以类似如下方式引用。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code>emp_rec<span class="token punctuation">.</span>ename <span class="token operator">:=</span><span class="token string">'ADAMS'</span><span class="token punctuation">;</span>
</code></pre></div><p>下面，我们使用记录型变量来实现和上面同样的功能。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">declare</span>
 <span class="token comment">-- 定义记录型变量</span>
 emp_rec emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 得到7839一行的信息 </span>
 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> emp_rec <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7839</span><span class="token punctuation">;</span>
 <span class="token comment">-- 打印姓名和薪水</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>emp_rec<span class="token punctuation">.</span>ename <span class="token operator">||</span> <span class="token string">'的薪水是'</span> <span class="token operator">||</span> emp_rec<span class="token punctuation">.</span>sal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pl-sql中的条件语句"><a href="#pl-sql中的条件语句" class="header-anchor">#</a> PL/SQL中的条件语句</h3> <p>在PL/SQL中，if语句有三种形式：</p> <ul><li><p>第一种:</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">IF</span> 条件 <span class="token keyword">THEN</span> 
 语句<span class="token number">1</span><span class="token punctuation">;</span>
 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>第二种:</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">IF</span> 条件 <span class="token keyword">THEN</span> 
 语句<span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token keyword">ELSE</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>第三种:</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">IF</span> 条件<span class="token number">1</span> <span class="token keyword">THEN</span> 语句<span class="token punctuation">;</span>
 <span class="token keyword">ELSIF</span> 条件<span class="token number">2</span> <span class="token keyword">THEN</span> 语句<span class="token punctuation">;</span>
 <span class="token keyword">ELSE</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>下面我们编写一个判断用户从键盘输入的数字的程序。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
 <span class="token comment">-- 接收一个键盘输入，num是一个地址值，在该地址上保存了输入的值。</span>
accept num prompt <span class="token string">'请输入一个数字'</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> 
 <span class="token comment">-- 定义变量保存用户从键盘输入的数字，这里使用&amp;表示取该num中保存的值</span>
 pnum number <span class="token operator">:=</span> &amp;num<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token keyword">if</span> pnum <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'您输入的数字是0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">elsif</span> pnum <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'您输入的数字是1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">elsif</span> pnum <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'您输入的数字是2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">else</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他数字'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pl-sql中的循环语句"><a href="#pl-sql中的循环语句" class="header-anchor">#</a> PL/SQL中的循环语句</h3> <p>PL/SQL中循环语句一般有三种形式：</p> <ul><li><p>WHILE循环</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">WHILE</span> 条件 <span class="token keyword">LOOP</span>
 表达式
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>下面来看一个具体的例子，使用WHILE循环打印数字1-10。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> 
pnum number <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token keyword">while</span> pnum<span class="token operator">&lt;=</span><span class="token number">10</span> <span class="token keyword">loop</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
 pnum <span class="token operator">:=</span> pnum<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>LOOP循环</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">LOOP</span>

<span class="token keyword">EXIT</span> <span class="token punctuation">[</span><span class="token keyword">WHEN</span> 条件<span class="token punctuation">]</span><span class="token punctuation">;</span>
表达式

<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>这种循环体和WHILE循环有所区别，当满足条件时，退出循环体。现在，使用LOOP循环实现和上面相同功能的程序。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span>
	pnum number <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span> 
	 <span class="token keyword">loop</span> 
 <span class="token comment">-- 退出条件，循环变量的值大于10</span>
 <span class="token keyword">exit</span> <span class="token keyword">when</span> number <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
 <span class="token comment">-- 打印该变量的值</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
 pnum <span class="token operator">:=</span> pnum<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>FOR循环</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">FOR</span> 变量 <span class="token keyword">IN</span> 取值范围 <span class="token keyword">LOOP</span>
 语句<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来，我们实现和前面功能一样的程序。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 pnum number <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token keyword">for</span> pnum <span class="token keyword">in</span> <span class="token number">1.</span><span class="token number">.10</span> <span class="token keyword">loop</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  pnum <span class="token operator">:=</span> pnum<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="pl-sql光标"><a href="#pl-sql光标" class="header-anchor">#</a> PL/SQL光标</h2> <p>在PL/SQL中，我们使用光标作为结果集，即使用光标代表一个集合。</p> <h3 id="定义光标"><a href="#定义光标" class="header-anchor">#</a> 定义光标</h3> <p>其在PL/SQL中按如下方式定义：</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">CURSOR</span> 光标名 <span class="token punctuation">[</span><span class="token punctuation">(</span>参数名 数据类型<span class="token punctuation">[</span><span class="token punctuation">,</span>参数名 数据类型<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">IS</span> <span class="token keyword">SELECT</span> 语句<span class="token punctuation">;</span>
</code></pre></div><h3 id="使用光标"><a href="#使用光标" class="header-anchor">#</a> 使用光标</h3> <p>一般来说，我们使用光标有以下步骤：</p> <ol><li><p>定义一个光标：<code>cursor c1 is select ename from emp;</code>。</p></li> <li><p>打开光标：<code>open c1;</code></p></li> <li><p>取一行光标的值：<code>fetch c1 into pename;</code>fetch在其内部维护了一个指针，其有两个作用，一个作用是取出当前指针所指向的记录值，另外一个作用是指向下一条记录。</p></li> <li><p>关闭光标：<code>close c1;</code></p></li></ol> <p>接下来，我们定义一个光标并循环它用于查询并打印员工的姓名和薪水。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token comment">-- 定义一个光标</span>
 <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
 <span class="token comment">-- 为光标定义对应的变量</span>
 pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
 psal emp<span class="token punctuation">.</span>sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
<span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">loop</span>
<span class="token comment">-- 取一条记录,注意这里的pename,psal变量的顺序要和光标定义时ename,sal的顺序一致</span>
<span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pename<span class="token punctuation">,</span>psal<span class="token punctuation">;</span>
<span class="token keyword">exit</span> <span class="token keyword">when</span> 没有取到记录<span class="token punctuation">;</span>
<span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>在这里，我们需要指定循环退出的条件，否则就会出现死循环。为了这个目的，我们需要使用到光标的属性<code>%found</code>，<code>%notfound</code>。这里，我们使用<code>%notfound</code>属性表示没有取到值。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token comment">-- 定义一个光标</span>
 <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span>sal <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
 <span class="token comment">-- 为光标定义对应的变量</span>
 pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
 psal emp<span class="token punctuation">.</span>sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
<span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">loop</span>
<span class="token comment">-- 取一条记录,注意这里的pename,psal变量的顺序要和光标定义时ename,sal的顺序一致</span>
<span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pename<span class="token punctuation">,</span>psal<span class="token punctuation">;</span>
<span class="token keyword">exit</span> <span class="token keyword">when</span> cemp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>
<span class="token comment">-- 打印</span>
dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pename<span class="token operator">||</span><span class="token string">'的薪水是'</span><span class="token operator">||</span>psal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
 <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来，我们使用光标完成给员工涨工资的功能，总裁1000，经理800，其他400。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>empjob <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
 pempno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
 pjob emp<span class="token punctuation">.</span>empjob<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 打开光标</span>
 <span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
 <span class="token keyword">loop</span>
  <span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pempno<span class="token punctuation">,</span>pjob<span class="token punctuation">;</span>
  <span class="token keyword">exit</span> <span class="token keyword">when</span> cemp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>
  <span class="token keyword">if</span> pjob<span class="token operator">=</span><span class="token string">'PRESIDENT'</span> <span class="token keyword">then</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">1000</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">elsif</span> pjob<span class="token operator">=</span><span class="token string">'MANAGER'</span> <span class="token keyword">then</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">800</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
  	 <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">400</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
 <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'涨工资完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>执行完这条语句之后，我们发现数据并没有发生变化，因为Oracle数据库默认的事务级别是<code>read commit</code>；</p> <p>因此，我们还需要手动提交。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>empjob <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
 pempno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
 pjob emp<span class="token punctuation">.</span>empjob<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 打开光标</span>
 <span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
 <span class="token keyword">loop</span>
  <span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pempno<span class="token punctuation">,</span>pjob<span class="token punctuation">;</span>
  <span class="token keyword">exit</span> <span class="token keyword">when</span> cemp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>
  <span class="token keyword">if</span> pjob<span class="token operator">=</span><span class="token string">'PRESIDENT'</span> <span class="token keyword">then</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">1000</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">elsif</span> pjob<span class="token operator">=</span><span class="token string">'MANAGER'</span> <span class="token keyword">then</span> <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">800</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">else</span>
  	 <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> sal<span class="token operator">+</span><span class="token number">400</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> pempno<span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
 <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
 <span class="token keyword">commit</span><span class="token punctuation">;</span>
 dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'涨工资完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="光标的属性"><a href="#光标的属性" class="header-anchor">#</a> 光标的属性</h3> <p>在PL/SQL中，光标总共有四个属性<code>%found</code>、<code>%notfound</code>、<code>isopen</code>、<code>rowcount</code>。</p> <ul><li><code>%found</code>：fetch命令从光标中取到值</li> <li><code>%notfound</code>：fetch命令从光标中未取到值</li> <li><code>isopen</code>：判断光标是否打开</li> <li><code>rowcount</code>：影响的行数</li></ul> <p>为了理解后面<code>isopen</code>属性，我们尝试写一个例子。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
  <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>empjob <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
  pempno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
  pjob emp<span class="token punctuation">.</span>empjob<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span> 
  <span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
  <span class="token keyword">if</span> cemp<span class="token operator">%</span>isopen <span class="token keyword">then</span>
    dbms<span class="token punctuation">.</span>output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'光标已经打开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> 
    dbms<span class="token punctuation">.</span>output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'光标没有打开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
  <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>为了理解光标的<code>%rowcount</code>属性，我们再写一个例子。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
  <span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> empno<span class="token punctuation">,</span>empjob <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
  pempno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
  pjob emp<span class="token punctuation">.</span>empjob<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span> 
  <span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
  <span class="token keyword">loop</span>
  <span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pempno<span class="token punctuation">,</span>pjob<span class="token punctuation">;</span>
  <span class="token keyword">exit</span> <span class="token keyword">when</span> cemp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">(</span><span class="token string">'rowcount:'</span> <span class="token operator">||</span> cemp<span class="token operator">%</span>rowcount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
  <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>查看<code>%rowcount</code>显示的是每次循环取出的记录数，而不是总行数。</p> <h3 id="光标数限制"><a href="#光标数限制" class="header-anchor">#</a> 光标数限制</h3> <p>默认情况下，Oracle只允许在同一个会话中，打开300个光标。可以通过以下设置进行修改。例如，我们可以修改打开光标数为400。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">alter</span> system <span class="token keyword">set</span> open_cursors <span class="token operator">=</span> <span class="token number">400</span> scope <span class="token operator">=</span> <span class="token keyword">both</span><span class="token punctuation">;</span>
</code></pre></div><p>注意scope的取值有三个<code>both</code>、<code>memory</code>、<code>spfile</code>。</p> <ul><li><code>memory</code>表示只更改当前实例，不更改参数文件。</li> <li><code>spfile</code>表示只更改参数文件，不更改当前实例，需要重启数据库。</li> <li><code>both</code>表示既更改参数文件，也更改当前实例</li></ul> <h3 id="带参数的光标"><a href="#带参数的光标" class="header-anchor">#</a> 带参数的光标</h3> <p>回顾光标的定义，可以发现，光标是可以定义参数的。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">CURSOR</span> 光标名 <span class="token punctuation">[</span><span class="token punctuation">(</span>参数名 数据类型<span class="token punctuation">[</span><span class="token punctuation">,</span>参数名 数据类型<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">IS</span> <span class="token keyword">SELECT</span> 语句<span class="token punctuation">;</span>
</code></pre></div><p>接下来我们来举一个例子，查询某个部门中员工的姓名。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token keyword">cursor</span> cemp<span class="token punctuation">(</span>dno number<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">select</span> ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> dno<span class="token punctuation">;</span>
 pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 打开光标</span>
 <span class="token keyword">open</span> cemp<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">loop</span>
  <span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pename<span class="token punctuation">;</span>
  <span class="token keyword">exit</span> <span class="token keyword">when</span> cemp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>
  dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>pename<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>
 <span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="例外-异常"><a href="#例外-异常" class="header-anchor">#</a> 例外（异常）</h2> <p>例外是程序设计语言提供的一项功能，用于增强程序的健壮性和容错性。</p> <p>Oracle中存在两种例外，一种是系统例外，另外一种是自定义例外。</p> <h3 id="系统例外的分类"><a href="#系统例外的分类" class="header-anchor">#</a> 系统例外的分类</h3> <ul><li><p>No_data_found：没有找到数据</p></li> <li><p>Too _many_rows: (select ... into 语句匹配多个行)</p></li> <li><p>Zero_divide：（被零除）</p></li> <li><p>Value_error：（算术或转换错误）</p></li> <li><p>Time_on_resource：（在等待资源时发生超时）</p></li></ul> <p>首先，我们尝试举一个No_data_found例外的例子</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> servertoutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
  pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 查询员工号为1234的员工姓名</span>
 <span class="token keyword">select</span> ename <span class="token keyword">into</span> pename <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno<span class="token operator">=</span><span class="token number">1234</span><span class="token punctuation">;</span>
 <span class="token keyword">exception</span>
  <span class="token keyword">when</span> no_data_found <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'没有找到该员工'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他例外'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>由于没有员工号为1234的员工，所以程序将<code>no_data_found</code>抛出异常。在这个程序中，我们使用exception捕获<code>no_data_found</code>例外，并使用<code>when... then</code>处理它。运行程序可以发现它抛出了一个<code>no_data_found</code>异常。</p> <p>接下来，我们尝试一下<code>too_many_rows</code>异常。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
  pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 <span class="token comment">-- 查询所有10号部门的员工姓名</span>
 <span class="token keyword">select</span> ename <span class="token keyword">into</span> pename <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
 <span class="token keyword">exception</span>
  <span class="token keyword">when</span> too_many_rows <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'select into匹配了多行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他例外'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>由于10号部门的员工有多个，所以如果执行程序，程序打印出<code>select into匹配了多行</code>。</p> <p>接下来，我们再举一个<code>zero_divide</code>例外。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> 
 pnum number<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
	pnum<span class="token operator">:=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">exception</span> zero_divide <span class="token keyword">when</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'1:0不能做除数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'1:0不能做除数'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他例外'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>运行程序，可以看到将抛出<code>zero_divide</code>异常。</p> <p>最后，我们来看一个算术或转换错误，在这里我们将一个字符串赋值给一个number类型的变量。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
 <span class="token comment">-- 定义一个number类型的变量</span>
 pnum number<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
 pnum<span class="token operator">:=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
<span class="token keyword">exception</span> <span class="token keyword">when</span> value_error <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'算术或者转换异常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他例外'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>运行程序，程序打印出<code>算术或者转换异常</code>。</p> <h3 id="自定义例外"><a href="#自定义例外" class="header-anchor">#</a> 自定义例外</h3> <p>在Oracle中，我们可以像定义一个变量一样定义一个例外，只是变量的类型为exception，并使用raise抛出一个例外。接下来我们举一个例子，自定义一个例外。</p> <div class="language-plsql extra-class"><pre class="language-plsql"><code><span class="token keyword">set</span> serveroutput <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span>
	<span class="token keyword">cursor</span> cemp <span class="token keyword">is</span> <span class="token keyword">select</span> ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>
	pename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
	no_emp_exception <span class="token keyword">exception</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment">-- 打开光标</span>
	<span class="token keyword">open</span> cemp<span class="token punctuation">;</span>
	<span class="token keyword">fetch</span> cemp <span class="token keyword">into</span> pename<span class="token punctuation">;</span>
	<span class="token keyword">if</span> cemp<span class="token operator">%</span>notfound <span class="token keyword">then</span> 
	<span class="token comment">-- 抛出异常</span>
	<span class="token keyword">raise</span> no_emp_found<span class="token punctuation">;</span>
	<span class="token comment">-- 关闭光标</span>
	<span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
	<span class="token keyword">close</span> cemp<span class="token punctuation">;</span>
<span class="token keyword">exception</span> <span class="token keyword">when</span> no_emp_found <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'没有找到员工'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">when</span> <span class="token keyword">others</span> <span class="token keyword">then</span> dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'其他例外'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>执行程序，抛出自定义异常<code>no_emp_found</code>。当然，这里有一个问题，当为我们抛出异常后，无法再执行关闭光标的程序。Oracle检测到程序异常退出时，会自动启动一个process monitor进程做善后处理。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">3/11/2021, 7:31:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/mr-muggle/数据库/Oracle/Oracle进阶知识/存储过程和存储函数.html">
        存储过程和存储函数
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#pl-sql简介" title="PL/SQL简介" class="ant-anchor-link-title">PL/SQL简介</a></div><div class="ant-anchor-link"><a href="#pl-sql基础语法" title="PL/SQL基础语法" class="ant-anchor-link-title">PL/SQL基础语法</a><div class="ant-anchor-link"><a href="#pl-sql基本类型变量" title="PL/SQL基本类型变量" class="ant-anchor-link-title">PL/SQL基本类型变量</a></div><div class="ant-anchor-link"><a href="#pl-sql引用型变量" title="PL/SQL引用型变量" class="ant-anchor-link-title">PL/SQL引用型变量</a></div><div class="ant-anchor-link"><a href="#pl-sql记录型变量" title="PL/SQL记录型变量" class="ant-anchor-link-title">PL/SQL记录型变量</a></div><div class="ant-anchor-link"><a href="#pl-sql中的条件语句" title="PL/SQL中的条件语句" class="ant-anchor-link-title">PL/SQL中的条件语句</a></div><div class="ant-anchor-link"><a href="#pl-sql中的循环语句" title="PL/SQL中的循环语句" class="ant-anchor-link-title">PL/SQL中的循环语句</a></div></div><div class="ant-anchor-link"><a href="#pl-sql光标" title="PL/SQL光标" class="ant-anchor-link-title">PL/SQL光标</a><div class="ant-anchor-link"><a href="#定义光标" title="定义光标" class="ant-anchor-link-title">定义光标</a></div><div class="ant-anchor-link"><a href="#使用光标" title="使用光标" class="ant-anchor-link-title">使用光标</a></div><div class="ant-anchor-link"><a href="#光标的属性" title="光标的属性" class="ant-anchor-link-title">光标的属性</a></div><div class="ant-anchor-link"><a href="#光标数限制" title="光标数限制" class="ant-anchor-link-title">光标数限制</a></div><div class="ant-anchor-link"><a href="#带参数的光标" title="带参数的光标" class="ant-anchor-link-title">带参数的光标</a></div></div><div class="ant-anchor-link"><a href="#例外-异常" title="例外（异常）" class="ant-anchor-link-title">例外（异常）</a><div class="ant-anchor-link"><a href="#系统例外的分类" title="系统例外的分类" class="ant-anchor-link-title">系统例外的分类</a></div><div class="ant-anchor-link"><a href="#自定义例外" title="自定义例外" class="ant-anchor-link-title">自定义例外</a></div></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/27.10fbd948.js" defer></script>
  </body>
</html>