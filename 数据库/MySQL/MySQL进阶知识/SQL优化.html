<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>SQL优化 | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/25.0536eb3c.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/27.10fbd948.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/34.112b9f11.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/41.ef41848b.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/61.d314066d.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/91.0823b62f.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html" title="SQL优化" class="active sidebar-link">SQL优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#定位慢查询" title="定位慢查询" class="sidebar-link">定位慢查询</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#使用诊断工具分析慢查询" title="使用诊断工具分析慢查询" class="sidebar-link">使用诊断工具分析慢查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#使用explain诊断工具分析慢查询" title="使用explain诊断工具分析慢查询" class="sidebar-link">使用explain诊断工具分析慢查询</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#使用show-profile诊断工具分析慢查询" title="使用 show profile诊断工具分析慢查询" class="sidebar-link">使用 show profile诊断工具分析慢查询</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#使用trace诊断工具分析慢查询" title="使用trace诊断工具分析慢查询" class="sidebar-link">使用trace诊断工具分析慢查询</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#条件字段有索引-不走索引的情况" title="条件字段有索引，不走索引的情况" class="sidebar-link">条件字段有索引，不走索引的情况</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#数据导入速度优化思路" title="数据导入速度优化思路" class="sidebar-link">数据导入速度优化思路</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#排序-分组查询优化思路" title="排序，分组查询优化思路" class="sidebar-link">排序，分组查询优化思路</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#分页查询优化思路" title="分页查询优化思路" class="sidebar-link">分页查询优化思路</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/SQL优化.html#关联查询优化思路" title="关联查询优化思路" class="sidebar-link">关联查询优化思路</a></li></ul></li><li><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/MySQL索引.html" title="MySQL索引" class="sidebar-link">MySQL索引</a></li><li><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/MySQL锁.html" title="MySQL锁" class="sidebar-link">MySQL锁</a></li><li><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/MySQL事务.html" title="MySQL事务" class="sidebar-link">MySQL事务</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="定位慢查询"><a href="#定位慢查询" class="header-anchor">#</a> 定位慢查询</h2> <p>在工作中可能会遇到某个新功能在测试时需要很久才返回结果，这时就应该分析是不是慢查询导致的。如果确实有慢查询，又应该怎么去分析 SQL 执行效率呢？这一篇文章我们就来学习怎么找到慢查询和怎么分析 SQL 执行效率。</p> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%AE%9A%E4%BD%8D%E6%85%A2%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%96%B9%E6%B3%95.png" alt="定位慢查询"></p> <h2 id="使用诊断工具分析慢查询"><a href="#使用诊断工具分析慢查询" class="header-anchor">#</a> 使用诊断工具分析慢查询</h2> <p>定位到慢查询语句后，我们就要开始分析 SQL 执行效率了，对此，我们可以通过<code>explain</code>、<code>show profile</code> 和 <code>trace</code> 等诊断工具来分析慢查询。</p> <h3 id="使用explain诊断工具分析慢查询"><a href="#使用explain诊断工具分析慢查询" class="header-anchor">#</a> 使用<code>explain</code>诊断工具分析慢查询</h3> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E4%BD%BF%E7%94%A8explain%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90%E6%85%A2%E6%9F%A5%E8%AF%A2.png" alt="使用explain诊断工具分析慢查询"></p> <ul><li><p><code>explain</code>各字段的含义</p> <table><thead><tr><th style="text-align:left;">列名</th> <th style="text-align:left;">解释</th></tr></thead> <tbody><tr><td style="text-align:left;">id</td> <td style="text-align:left;">查询编号</td></tr> <tr><td style="text-align:left;"><strong>select_type</strong></td> <td style="text-align:left;">查询类型：显示本行是简单还是复杂查询</td></tr> <tr><td style="text-align:left;">table</td> <td style="text-align:left;">涉及到的表</td></tr> <tr><td style="text-align:left;">partitions</td> <td style="text-align:left;">匹配的分区：查询将匹配记录所在的分区。仅当使用 partition 关键字时才显示该列。对于非分区表，该值为 NULL。</td></tr> <tr><td style="text-align:left;"><strong>type</strong></td> <td style="text-align:left;">本次查询的表连接类型</td></tr> <tr><td style="text-align:left;">possible_keys</td> <td style="text-align:left;">可能选择的索引</td></tr> <tr><td style="text-align:left;"><strong>key</strong></td> <td style="text-align:left;">实际选择的索引</td></tr> <tr><td style="text-align:left;">key_len</td> <td style="text-align:left;">被选择的索引长度：一般用于判断联合索引有多少列被选择了</td></tr> <tr><td style="text-align:left;">ref</td> <td style="text-align:left;">与索引比较的列</td></tr> <tr><td style="text-align:left;"><strong>rows</strong></td> <td style="text-align:left;">预计需要扫描的行数，对 InnoDB 来说，这个值是估值，并不一定准确</td></tr> <tr><td style="text-align:left;">filtered</td> <td style="text-align:left;">按条件筛选的行的百分比</td></tr> <tr><td style="text-align:left;"><strong>Extra</strong></td> <td style="text-align:left;">附加信息</td></tr></tbody></table></li> <li><p><code>select_type</code>各值的含义</p> <table><thead><tr><th style="text-align:left;">select_type 的值</th> <th style="text-align:left;">解释</th></tr></thead> <tbody><tr><td style="text-align:left;">SIMPLE</td> <td style="text-align:left;">简单查询 (不使用关联查询或子查询)</td></tr> <tr><td style="text-align:left;">PRIMARY</td> <td style="text-align:left;">如果包含关联查询或者子查询，则最外层的查询部分标记为 primary</td></tr> <tr><td style="text-align:left;">UNION</td> <td style="text-align:left;">联合查询中第二个及后面的查询</td></tr> <tr><td style="text-align:left;">DEPENDENT UNION</td> <td style="text-align:left;">满足依赖外部的关联查询中第二个及以后的查询</td></tr> <tr><td style="text-align:left;">UNION RESULT</td> <td style="text-align:left;">联合查询的结果</td></tr> <tr><td style="text-align:left;">SUBQUERY</td> <td style="text-align:left;">子查询中的第一个查询</td></tr> <tr><td style="text-align:left;">DEPENDENT SUBQUERY</td> <td style="text-align:left;">子查询中的第一个查询，并且依赖外部查询</td></tr> <tr><td style="text-align:left;">DERIVED</td> <td style="text-align:left;">用到派生表的查询</td></tr> <tr><td style="text-align:left;">MATERIALIZED</td> <td style="text-align:left;">被物化的子查询</td></tr> <tr><td style="text-align:left;">UNCACHEABLE SUBQUERY</td> <td style="text-align:left;">一个子查询的结果不能被缓存，必须重新评估外层查询的每一行</td></tr> <tr><td style="text-align:left;">UNCACHEABLE UNION</td> <td style="text-align:left;">关联查询第二个或后面的语句属于不可缓存的子查询</td></tr></tbody></table></li> <li><p><code>type</code>各值的含义</p> <table><thead><tr><th style="text-align:left;">type 的值</th> <th style="text-align:left;">解释</th></tr></thead> <tbody><tr><td style="text-align:left;">system</td> <td style="text-align:left;">查询对象表只有一行数据，且只能用于 MyISAM 和 Memory 引擎的表，这是最好的情况</td></tr> <tr><td style="text-align:left;">const</td> <td style="text-align:left;">基于主键或唯一索引查询，最多返回一条结果</td></tr> <tr><td style="text-align:left;">eq_ref</td> <td style="text-align:left;">表连接时基于主键或非 NULL 的唯一索引完成扫描</td></tr> <tr><td style="text-align:left;">ref</td> <td style="text-align:left;">基于普通索引的等值查询，或者表间等值连接</td></tr> <tr><td style="text-align:left;">fulltext</td> <td style="text-align:left;">全文检索</td></tr> <tr><td style="text-align:left;">ref_or_null</td> <td style="text-align:left;">表连接类型是 ref，但进行扫描的索引列中可能包含 NULL 值</td></tr> <tr><td style="text-align:left;">index_merge</td> <td style="text-align:left;">利用多个索引</td></tr> <tr><td style="text-align:left;">unique_subquery</td> <td style="text-align:left;">子查询中使用唯一索引</td></tr> <tr><td style="text-align:left;">index_subquery</td> <td style="text-align:left;">子查询中使用普通索引</td></tr> <tr><td style="text-align:left;">range</td> <td style="text-align:left;">利用索引进行范围查询</td></tr> <tr><td style="text-align:left;">index</td> <td style="text-align:left;">全索引扫描</td></tr> <tr><td style="text-align:left;">ALL</td> <td style="text-align:left;">全表扫描</td></tr></tbody></table> <p><strong>上表的这些情况，查询性能从上到下依次是最好到最差。</strong></p></li> <li><p><code>Extra</code>各值的含义</p> <table><thead><tr><th>Extra 常见的值解释例子</th> <th>解释</th> <th>例子</th></tr></thead> <tbody><tr><td>Using filesort</td> <td>将用外部排序而不是索引排序，数据较小时从内存排序，否则需要在磁盘完成排序</td> <td>explain select * from t1 order by create_time;</td></tr> <tr><td>Using temporary</td> <td>需要创建一个临时表来存储结构，通常发生对没有索引的列进行 GROUP BY 时</td> <td>explain select * from t1 group by create_time;</td></tr> <tr><td>Using index</td> <td>使用覆盖索引</td> <td>explain select a from t1 where a=111;</td></tr> <tr><td>Using where</td> <td>使用 where 语句来处理结果</td> <td>explain select * from t1 where create_time=‘2019-06-18 14:38:24’;</td></tr> <tr><td>Impossible WHERE</td> <td>对 where 子句判断的结果总是 false 而不能选择任何数据</td> <td>explain select * from t1 where 1&lt;0;</td></tr> <tr><td>Using join buffer (Block Nested Loop)</td> <td>关联查询中，被驱动表的关联字段没索引</td> <td>explain select * from t1 straight_join t2 on (t1.create_time=t2.create_time);</td></tr> <tr><td>Using index condition</td> <td>先条件过滤索引，再查数据</td> <td>explain select * from t1 where a &gt;900 and a like “%9”;</td></tr> <tr><td>Select tables optimized away</td> <td>使用某些聚合函数（比如 max、min）来访问存在索引的某个字段时</td> <td>explain select max(a) from t1;</td></tr></tbody></table></li></ul> <h3 id="使用show-profile诊断工具分析慢查询"><a href="#使用show-profile诊断工具分析慢查询" class="header-anchor">#</a> 使用<code>show profile</code>诊断工具分析慢查询</h3> <p>有时需要确定 SQL 到底慢在哪个环节，此时 explain 可能不好确定。在 MySQL 数据库中，通过 profile，能够更清楚地了解 SQL 执行过程的资源使用情况，能让我们知道到底慢在哪个环节。</p> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E4%BD%BF%E7%94%A8profile%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90%E6%85%A2%E6%9F%A5%E8%AF%A2.png" alt="使用诊断工具profile分析慢查询"></p> <h3 id="使用trace诊断工具分析慢查询"><a href="#使用trace诊断工具分析慢查询" class="header-anchor">#</a> 使用<code>trace</code>诊断工具分析慢查询</h3> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E4%BD%BF%E7%94%A8trace%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90%E6%85%A2%E6%9F%A5%E8%AF%A2.png" alt="使用trace诊断工具分析慢查询"></p> <h2 id="条件字段有索引-不走索引的情况"><a href="#条件字段有索引-不走索引的情况" class="header-anchor">#</a> 条件字段有索引，不走索引的情况</h2> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E6%9D%A1%E4%BB%B6%E5%AD%97%E6%AE%B5%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95.png" alt="MySQL条件字段有索引但是不走索引的情况"></p> <h2 id="数据导入速度优化思路"><a href="#数据导入速度优化思路" class="header-anchor">#</a> 数据导入速度优化思路</h2> <p>我们有时会遇到批量数据导入的场景，而数据量稍微大点，会发现导入非常耗时间。我们可以采用以下方式优化。</p> <ul><li><p>一次插入多行的值；插入行所需的时间，大部分时间耗费在客户端与服务端通信的时间，因此可以使用 insert 包含多个值来减少客户端和服务器之间的通信。建议<strong>有大批量导入时，推荐一条insert语句插入多行数据。</strong></p></li> <li><p>关闭自动提交，多次插入数据的 SQL 一次提交；使用<code>SET autocommit=0;</code>命令关闭自动提交。因为批量导入大部分时间耗费在客户端与服务端通信的时间，所以多条 insert 语句合并提交可以减少客户端与服务端通信的时间，并且合并提交还可以减少数据落盘的次数。</p></li> <li><p>调整参数，innodb_flush_log_at_trx_commit 和 sync_binlog 都设置为0（当然这种情况可能会丢数据）。</p> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%BD%B1%E5%93%8DMySQL%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0.png" alt="影响MySQL数据写入数据的两个参数.png"></p></li></ul> <h2 id="排序-分组查询优化思路"><a href="#排序-分组查询优化思路" class="header-anchor">#</a> 排序，分组查询优化思路</h2> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E8%AE%A9%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84%E6%9B%B4%E5%BF%AB%E7%9A%84%E6%96%B9%E6%B3%95.png" alt="让排序和分组更快的方法"></p> <h2 id="分页查询优化思路"><a href="#分页查询优化思路" class="header-anchor">#</a> 分页查询优化思路</h2> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF.png" alt="分页查询优化思路"></p> <h2 id="关联查询优化思路"><a href="#关联查询优化思路" class="header-anchor">#</a> 关联查询优化思路</h2> <p>我们在使用数据库查询数据时，有时一张表并不能满足我们的需求，很多时候都涉及到多张表的连接查询。今天，我们就一起研究关联查询的一些优化技巧。在说关联查询优化之前，我们先看下跟关联查询有关的几个算法：</p> <p><img src="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%89%E7%A7%8D%E7%AE%97%E6%B3%95.png" alt="关联查询的三种算法"></p> <p>通过上面的内容，我们知道了 BNL、NLJ 和 BKA 的原理，因此让 BNL变成 NLJ 或者 BKA，可以提高 join 的效率。下面我们可以采用以下方式来优化关联查询。</p> <ul><li>对被驱动表关联字段添加索引，让 BNL变成 NLJ 或者 BKA。</li> <li>在写 SQL 时，如果确定被关联字段有索引的情况下，建议用小表做驱动表。</li> <li>当遇到 BNL 的 join 语句，如果不方便在关联字段上添加索引，不妨尝试创建临时表，然后在临时表中的关联字段上添加索引，然后通过临时表来做关联查询。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">3/11/2021, 7:31:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/mr-muggle/数据库/MySQL/MySQL进阶知识/MySQL索引.html">
        MySQL索引
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#定位慢查询" title="定位慢查询" class="ant-anchor-link-title">定位慢查询</a></div><div class="ant-anchor-link"><a href="#使用诊断工具分析慢查询" title="使用诊断工具分析慢查询" class="ant-anchor-link-title">使用诊断工具分析慢查询</a><div class="ant-anchor-link"><a href="#使用explain诊断工具分析慢查询" title="使用explain诊断工具分析慢查询" class="ant-anchor-link-title">使用explain诊断工具分析慢查询</a></div><div class="ant-anchor-link"><a href="#使用show-profile诊断工具分析慢查询" title="使用 show profile诊断工具分析慢查询" class="ant-anchor-link-title">使用 show profile诊断工具分析慢查询</a></div><div class="ant-anchor-link"><a href="#使用trace诊断工具分析慢查询" title="使用trace诊断工具分析慢查询" class="ant-anchor-link-title">使用trace诊断工具分析慢查询</a></div></div><div class="ant-anchor-link"><a href="#条件字段有索引-不走索引的情况" title="条件字段有索引，不走索引的情况" class="ant-anchor-link-title">条件字段有索引，不走索引的情况</a></div><div class="ant-anchor-link"><a href="#数据导入速度优化思路" title="数据导入速度优化思路" class="ant-anchor-link-title">数据导入速度优化思路</a></div><div class="ant-anchor-link"><a href="#排序-分组查询优化思路" title="排序，分组查询优化思路" class="ant-anchor-link-title">排序，分组查询优化思路</a></div><div class="ant-anchor-link"><a href="#分页查询优化思路" title="分页查询优化思路" class="ant-anchor-link-title">分页查询优化思路</a></div><div class="ant-anchor-link"><a href="#关联查询优化思路" title="关联查询优化思路" class="ant-anchor-link-title">关联查询优化思路</a></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/25.0536eb3c.js" defer></script>
  </body>
</html>