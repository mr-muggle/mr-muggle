<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Redis的一些有用的小功能 | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/34.112b9f11.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/25.0536eb3c.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/27.10fbd948.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/41.ef41848b.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/61.d314066d.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/91.0823b62f.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/数据库/Redis/初识Redis.html" title="初识 Redis" class="sidebar-link">初识 Redis</a></li><li><a href="/mr-muggle/数据库/Redis/API的理解和使用.html" title="API的理解和使用" class="sidebar-link">API的理解和使用</a></li><li><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html" title="Redis的一些有用的小功能" class="active sidebar-link">Redis的一些有用的小功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis的一些小功能" title="Redis的一些小功能" class="sidebar-link">Redis的一些小功能</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis慢查询分析" title="Redis慢查询分析" class="sidebar-link">Redis慢查询分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis慢查询配置参数" title="Redis慢查询配置参数" class="sidebar-link">Redis慢查询配置参数</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#修改redis配置参数" title="修改Redis配置参数" class="sidebar-link">修改Redis配置参数</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取慢查询日志" title="获取慢查询日志" class="sidebar-link">获取慢查询日志</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取慢查询日志列表当前的长度" title="获取慢查询日志列表当前的长度" class="sidebar-link">获取慢查询日志列表当前的长度</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#慢查询日志重置" title="慢查询日志重置" class="sidebar-link">慢查询日志重置</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#慢查询最佳实践" title="慢查询最佳实践" class="sidebar-link">慢查询最佳实践</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis官方提供的shell工具" title="Redis官方提供的Shell工具" class="sidebar-link">Redis官方提供的Shell工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#shell工具之redis-cli" title="Shell工具之redis-cli" class="sidebar-link">Shell工具之redis-cli</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#shell工具之redis-server" title="Shell工具之redis-server" class="sidebar-link">Shell工具之redis-server</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#shell工具之redis-benchmark" title="Shell工具之redis-benchmark" class="sidebar-link">Shell工具之redis-benchmark</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis的pipeline机制" title="Redis的Pipeline机制" class="sidebar-link">Redis的Pipeline机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis使用pipeline" title="Redis使用Pipeline" class="sidebar-link">Redis使用Pipeline</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#原生批量命令与pipeline对比" title="原生批量命令与Pipeline对比" class="sidebar-link">原生批量命令与Pipeline对比</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#pipeline最佳实践" title="Pipeline最佳实践" class="sidebar-link">Pipeline最佳实践</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis事务功能概述" title="Redis事务功能概述" class="sidebar-link">Redis事务功能概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis事务基本用法" title="Redis事务基本用法" class="sidebar-link">Redis事务基本用法</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis事务错误处理机制" title="Redis事务错误处理机制" class="sidebar-link">Redis事务错误处理机制</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis中的bitmaps" title="Redis中的Bitmaps" class="sidebar-link">Redis中的Bitmaps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#bitmaps设置值" title="Bitmaps设置值" class="sidebar-link">Bitmaps设置值</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#bitmaps获取值" title="Bitmaps获取值" class="sidebar-link">Bitmaps获取值</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取bitmaps指定范围值为1的个数" title="获取Bitmaps指定范围值为1的个数" class="sidebar-link">获取Bitmaps指定范围值为1的个数</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#bitmaps间的运算" title="Bitmaps间的运算" class="sidebar-link">Bitmaps间的运算</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#计算bitmaps中第一个值为targetbit的偏移量" title="计算Bitmaps中第一个值为targetBit的偏移量" class="sidebar-link">计算Bitmaps中第一个值为targetBit的偏移量</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis中的hyperloglog" title="Redis中的HyperLogLog" class="sidebar-link">Redis中的HyperLogLog</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#添加指定元素到-hyperloglog-中" title="添加指定元素到 HyperLogLog 中" class="sidebar-link">添加指定元素到 HyperLogLog 中</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#计算独立用户数" title="计算独立用户数" class="sidebar-link">计算独立用户数</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#合并hyperloglog元素" title="合并HyperLogLog元素" class="sidebar-link">合并HyperLogLog元素</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis发布-订阅模式" title="Redis发布-订阅模式" class="sidebar-link">Redis发布-订阅模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#发布消息命令" title="发布消息命令" class="sidebar-link">发布消息命令</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#订阅消息命令" title="订阅消息命令" class="sidebar-link">订阅消息命令</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#取消订阅命令" title="取消订阅命令" class="sidebar-link">取消订阅命令</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#按照模式订阅和取消订阅" title="按照模式订阅和取消订阅" class="sidebar-link">按照模式订阅和取消订阅</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#查询订阅命令-查看活跃的频道" title="查询订阅命令-查看活跃的频道" class="sidebar-link">查询订阅命令-查看活跃的频道</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#查看订阅命令-查看频道订阅数" title="查看订阅命令-查看频道订阅数" class="sidebar-link">查看订阅命令-查看频道订阅数</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#查看订阅命令-查看模式订阅数" title="查看订阅命令-查看模式订阅数" class="sidebar-link">查看订阅命令-查看模式订阅数</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#redis地理信息定位-geo" title="Redis地理信息定位-GEO" class="sidebar-link">Redis地理信息定位-GEO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#增加地理位置信息" title="增加地理位置信息" class="sidebar-link">增加地理位置信息</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#更新地理位置信息" title="更新地理位置信息" class="sidebar-link">更新地理位置信息</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取地理位置信息" title="获取地理位置信息" class="sidebar-link">获取地理位置信息</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取两个地理位置的距离" title="获取两个地理位置的距离" class="sidebar-link">获取两个地理位置的距离</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取指定位置范围内的地理信息位置集合" title="获取指定位置范围内的地理信息位置集合" class="sidebar-link">获取指定位置范围内的地理信息位置集合</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#获取地理位置的hash值" title="获取地理位置的hash值" class="sidebar-link">获取地理位置的hash值</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/数据库/Redis/Redis的一些有用的小功能.html#删除地理位置信息" title="删除地理位置信息" class="sidebar-link">删除地理位置信息</a></li></ul></li></ul></li><li><a href="/mr-muggle/数据库/Redis/Redis客户端.html" title="Redis客户端" class="sidebar-link">Redis客户端</a></li><li><a href="/mr-muggle/数据库/Redis/Redis的两种持久化机制.html" title="Redis的两种持久化机制" class="sidebar-link">Redis的两种持久化机制</a></li><li><a href="/mr-muggle/数据库/Redis/Redis复制配置与原理.html" title="Redis复制配置与原理" class="sidebar-link">Redis复制配置与原理</a></li><li><a href="/mr-muggle/数据库/Redis/Redis阻塞原因与处理.html" title="Redis阻塞原因与处理" class="sidebar-link">Redis阻塞原因与处理</a></li><li><a href="/mr-muggle/数据库/Redis/Redis内存管理与优化.html" title="Redis内存管理与优化" class="sidebar-link">Redis内存管理与优化</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="redis的一些小功能"><a href="#redis的一些小功能" class="header-anchor">#</a> Redis的一些小功能</h2> <p>Redis提供的5种数据结构已经足够强大，但除此之外，Redis还提供了诸如慢查询分析、功能强大的Redis Shell、Pipeline、事务与Lua脚本、Bitmaps、HyperLogLog、发布订阅、GEO等附加功能，这些功能可以在某些场景发挥重要的作用。</p> <h2 id="redis慢查询分析"><a href="#redis慢查询分析" class="header-anchor">#</a> Redis慢查询分析</h2> <p>许多存储系统（例如MySQL）提供慢查询日志帮助开发和运维人员定位系统存在的慢操作。所谓慢查询日志就是系统在命令执行前后计算每条命令的执行时间，当超过预设阀值，就将这条命令的相关信息（例如：发生时间，耗时，命令的详细信息）记录下来，Redis也提供了类似的功能。</p> <p>一般来说，我们可以将Redis客户端执行一条命令·的过程拆分为以下四个阶段： <strong>发送命令、命令排队、命令执行、返回结果。</strong> 对于这四个阶段，Redis只统计命令执行这个阶段所耗费的时间。</p> <h3 id="redis慢查询配置参数"><a href="#redis慢查询配置参数" class="header-anchor">#</a> Redis慢查询配置参数</h3> <p>对于慢查询，我们一般配置两个参数，一个预设阈值，另一个最大日志记录数。</p> <ul><li><strong>预设阈值</strong>：配置这个选项就是设置最大超时时间（单位：微秒），当Redis执行命令耗费的时间超过这个预设阈值时，Redis就会记录这个慢查询，可以使用<code>slowlog-log-slower-than</code>参数设置超时时间。该参数默认值是10000。<strong>如果<code>slowlog-log-slower-than=0</code>会记录所有的命令，<code>slowlog-log-slowerthan&lt;0</code>对于任何命令都不会进行记录</strong>。</li> <li><strong>最大日志记录数</strong>：实际上，Redis使用了一个列表来存储慢查询日志，<code>slowlog-max-len</code>参数设置的就是列表的最大长度。当一个新的命令满足慢查询条件时慢查询将被插入到这个列表中，当慢查询日志列表已处于其最大长度时，最早插入的一个命令将从列表中移出。</li></ul> <h3 id="修改redis配置参数"><a href="#修改redis配置参数" class="header-anchor">#</a> 修改Redis配置参数</h3> <p>在Redis中有两种修改配置的方法，一种是修改配置文件，另一种是使用<code>config set</code>命令动态修改。例如下面使用<code>config set</code>命令将<code>slowlog-log-slower-than</code>设置为20000微秒，<code>slowlog-max-len</code>设置为1000。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">20000</span>
config <span class="token builtin class-name">set</span> slowlog-max-len <span class="token number">1000</span>
config rewrite
</code></pre></div><p><strong>如果要Redis将配置持久化到本地配置文件，需要执行config rewrite命令</strong>。</p> <p>虽然慢查询日志是存放在Redis内存列表中的，但是Redis并没有暴露这个列表的键，而是通过一组命令来实现对慢查询日志的访问和管理。下面介绍这几个命令。</p> <h3 id="获取慢查询日志"><a href="#获取慢查询日志" class="header-anchor">#</a> 获取慢查询日志</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>slowlog get <span class="token punctuation">[</span>n<span class="token punctuation">]</span>
</code></pre></div><p>下面操作返回当前Redis的慢查询，参数n可以指定条数。每个慢查询日志有4个属性组成，分别是慢查询日志的标识id、发生时间戳、命令耗时、执行命令和参数。</p> <h3 id="获取慢查询日志列表当前的长度"><a href="#获取慢查询日志列表当前的长度" class="header-anchor">#</a> 获取慢查询日志列表当前的长度</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>slowlog len
</code></pre></div><h3 id="慢查询日志重置"><a href="#慢查询日志重置" class="header-anchor">#</a> 慢查询日志重置</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>slowlog reset
</code></pre></div><p>这个命令实际上是对列表进行清理工作，清理过后，若执行<code>slowlog len</code>命令，日志长度为零。</p> <h3 id="慢查询最佳实践"><a href="#慢查询最佳实践" class="header-anchor">#</a> 慢查询最佳实践</h3> <ul><li><code>slowlog-max-len</code>配置建议：线上建议调大慢查询列表，记录慢查询时Redis会对长命令做截断操作，并不会占用大量内存。增大慢查询列表可以减缓慢查询被剔除的可能，线上可设置为1000以上。</li> <li><code>slowlog-log-slower-than</code>配置建议：默认值超过10毫秒判定为慢查询，需要根据Redis并发量调整该值。由于Redis采用单线程响应命令，对于高流量的场景，如果命令执行时间在1毫秒以上，那么Redis最多可支撑OPS不到1000。因此对于高OPS场景的Redis建议设置为1毫秒。</li></ul> <p>慢查询只记录命令执行时间，并不包括命令排队和网络传输时间。因此客户端执行命令的时间会大于命令实际执行时间。因为命令执行排队机制，慢查询会导致其他命令级联阻塞，因此<strong>当客户端出现请求超时，需要检查该时间点是否有对应的慢查询，从而分析出是否为慢查询导致的命令级联阻塞。</strong></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>由于慢查询日志是一个先进先出的队列，也就是说如果慢查询比较多的情况下，可能会丢失部分慢查询命令，为了防止这种情况发生，可以定期执行<code>slow get</code>命令将慢查询日志持久化到其他存储中（例如MySQL），然后可以制作可视化界面进行查询。</p></div> <p>Redis提供了redis-cli、redis-server、redis-benchmark等Shell工具。我们可以通过这些工具巧妙地解决问题。</p> <h2 id="redis官方提供的shell工具"><a href="#redis官方提供的shell工具" class="header-anchor">#</a> Redis官方提供的Shell工具</h2> <p>redis-cli除了<code>-h</code>、<code>-p</code>参数，还有其它很多有用的参数。，下面将对一些重要参数的含义以及使用场景进行说明。</p> <h3 id="shell工具之redis-cli"><a href="#shell工具之redis-cli" class="header-anchor">#</a> Shell工具之redis-cli</h3> <ol><li><code>-r</code>参数重复执行命令</li></ol> <p>-r（repeat）选项代表将命令执行多次，例如下面操作将会执行三次ping命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">-r</span> <span class="token number">3</span> <span class="token function">ping</span>
</code></pre></div><p>通过这个命令，将打印三次<code>PONG</code>。</p> <ol start="2"><li><code>-i</code>参数定时执行一次命令</li></ol> <p>-i（interval）选项代表每隔几秒执行一次命令，但是-i选项必须和-r选项一起使用，下面的操作会每隔1秒执行一次ping命令，一共执行5次。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">-r</span> <span class="token number">5</span> <span class="token parameter variable">-i</span> <span class="token number">1</span> <span class="token function">ping</span>
</code></pre></div><ol start="3"><li><code>--stat</code>参数实时获取Redis的重要统计信息</li></ol> <p><code>--stat</code>选项可以实时获取Redis的重要统计信息，虽然info命令中的统计信息更全，但是能实时看到一些增量的数据（例如requests）对于Redis的运维还是有一定帮助的。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--stat</span>
</code></pre></div><p>执行命令，输出如下结果。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>------- data ------ --------------------- load -------------------- - child -
keys       mem      clients blocked requests            connections          
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">9</span> <span class="token punctuation">(</span>+0<span class="token punctuation">)</span>              <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">10</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">11</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">12</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">13</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">14</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">15</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">16</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">17</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">18</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">19</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">20</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">21</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">22</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">23</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">24</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">25</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">26</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">27</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">28</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
------- data ------ --------------------- load -------------------- - child -
keys       mem      clients blocked requests            connections          
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">29</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">30</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">31</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">32</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">33</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">34</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">35</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">36</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">37</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">38</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">39</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">40</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">41</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">42</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">43</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">44</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">45</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">46</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">47</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
<span class="token number">0</span>          <span class="token number">834</span>.12K  <span class="token number">1</span>       <span class="token number">0</span>       <span class="token number">48</span> <span class="token punctuation">(</span>+1<span class="token punctuation">)</span>             <span class="token number">4</span>           
------- data ------ --------------------- load ------------
</code></pre></div><ol start="4"><li>--raw<code>和</code>--no-raw`命令返回结果是否格式化</li></ol> <p><code>--no-raw</code>选项是要求命令的返回结果必须是原始的格式，<code>--raw</code>恰恰相反，返回格式化后的结果。</p> <p>例如，我们设置一个中文的value。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token builtin class-name">set</span> hello <span class="token string">&quot;你好&quot;</span>
</code></pre></div><p>如果正常执行<code>get</code>或者使用<code>--no-raw</code>选项，那么返回的结果是二进制格式。</p> <p>redis执行get命令，返回二进制结果<code>\xe4\xbd\xa0\xe5\xa5\xbd</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli get hello
</code></pre></div><p>redis执行命令时使用<code>--no-raw</code>选项，同样返回二进制结果<code>\xe4\xbd\xa0\xe5\xa5\xbd</code>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli --no-raw get hello
</code></pre></div><p>如果在执行命令时使用<code>--raw</code>选项，将会返回中文。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--raw</span> get hello
</code></pre></div><h3 id="shell工具之redis-server"><a href="#shell工具之redis-server" class="header-anchor">#</a> Shell工具之redis-server</h3> <p>redis-server除了启动Redis外，还有一个<code>--test-memory</code>选项。 <strong>通过<code>redis-server --test-memory</code>命令，我们可以用来检测当前操作系统能否稳定地分配指定容量的内存给Redis，通过这种检测可以有效避免因为内存问题造成Redis崩溃。</strong></p> <p>例如下面操作检测当前操作系统能否提供1G的内存给Redis。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-server --test-memory <span class="token number">1024</span>
</code></pre></div><p>整个内存检测的时间比较长。当输出passed this test时说明内存检测完毕，最后会提示--test-memory只是简单检测，如果有质疑可以使用更加专业的内存检测工具。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>通常无需每次开启Redis实例时都执行--test-memory选项，该功能更偏向于调试和测试。</p></div> <h3 id="shell工具之redis-benchmark"><a href="#shell工具之redis-benchmark" class="header-anchor">#</a> Shell工具之redis-benchmark</h3> <p>redis-benchmark可以为Redis做基准性能测试，它提供了很多选项帮助开发和运维人员测试Redis的相关性能。</p> <ol><li><code>-c</code>参数代表客户端的并发数量（默认是50）</li></ol> <p><code>-c</code>（clients）选项代表客户端的并发数量（默认是50）。</p> <ol start="2"><li><code>-n</code>参数代表客户端请求总量（默认是100000）</li></ol> <p>例如：若我们执行命令<code>redis-benchmark -c 100 -n 20000</code>代表100各个客户端同时请求Redis，一共执行20000次。redis-benchmark会对各类数据结构的命令进行测试，并给出性能指标。</p> <ol start="3"><li><code>-t</code>参数对指定命令进行基准测试。</li></ol> <p><code>-t</code>参数可以对指定命令进行基准测试。当我们执行命令<code>redis-benchmark -t get,set -q</code>。终端将输出</p> <div class="language-bash extra-class"><pre class="language-bash"><code>SET: <span class="token number">57937.43</span> requests per second
GET: <span class="token number">59952.04</span> requests per second
</code></pre></div><ol start="4"><li><code>--csv</code>参数将结果按照csv格式输出</li></ol> <p><code>--csv</code>选项会将结果按照csv格式输出，便于后续处理，如导出到Excel等。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-benchmark <span class="token parameter variable">-t</span> get,set <span class="token parameter variable">--csv</span>
</code></pre></div><ol start="5"><li><code>-k</code>代表客户端是否使用keepalive</li></ol> <p>-k选项代表客户端是否使用keepalive，1为使用，0为不使用，默认值为1。</p> <h2 id="redis的pipeline机制"><a href="#redis的pipeline机制" class="header-anchor">#</a> Redis的Pipeline机制</h2> <p>Redis提供了批量操作命令（例如mget、mset等），有效地节约RTT。但大部分命令是不支持批量操作的，而且</p> <p>Redis的客户端和服务端可能部署在不同的机器上，由于网络延迟等因素，Redis执行命令的效率将大大下降。</p> <h3 id="redis使用pipeline"><a href="#redis使用pipeline" class="header-anchor">#</a> Redis使用Pipeline</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Pipeline（流水线）机制能改善上面这类问题，它能将一组Redis命令进行组装，通过一次RTT传输给Redis，再将这组Redis命令的执行结果按顺序返回给客户端。</p></div> <p>redis-cli的<code>--pipe</code>参数实际上就是使用Pipeline机制。但大部分开发人员更倾向于使用高级语言客户端中的Pipeline，目前大部分Redis客户端都支持Pipeline。</p> <h3 id="原生批量命令与pipeline对比"><a href="#原生批量命令与pipeline对比" class="header-anchor">#</a> 原生批量命令与Pipeline对比</h3> <ul><li>原生批量命令是原子的，Pipeline是非原子的。</li> <li>·原生批量命令是一个命令对应多个key，Pipeline支持多个命令。</li> <li>·原生批量命令是Redis服务端支持实现的，而Pipeline需要服务端和客户端的共同实现。</li></ul> <h3 id="pipeline最佳实践"><a href="#pipeline最佳实践" class="header-anchor">#</a> Pipeline最佳实践</h3> <p>Pipeline虽然好用，但是每次Pipeline组装的命令个数不能没有节制，否则一次组装Pipeline数据量过大，一方面会增加客户端的等待时间，另一方面会造成一定的网络阻塞，可以将一次包含大量命令的Pipeline拆分成多次
较小的Pipeline来完成。</p> <h2 id="redis事务功能概述"><a href="#redis事务功能概述" class="header-anchor">#</a> Redis事务功能概述</h2> <p>Redis提供了简单的事务功能，将一组需要一起执行的命令放到<code>multi</code>和<code>exec</code>两个命令之间。<code>multi</code>命令代表事务开始，<code>exec</code>命令代表事务结束，它们之间的命令是原子顺序执行的。如果要停止事务的执行，可以使用<code>discard</code>命令代替<code>exec</code>命令即可。</p> <h3 id="redis事务基本用法"><a href="#redis事务基本用法" class="header-anchor">#</a> Redis事务基本用法</h3> <p>下面进行集合添加元素操作：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd user:a:follow user:b
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sadd user:b:fans user:a
QUEUED
</code></pre></div><p>可以看到sadd命令此时的返回结果是QUEUED，代表命令并没有真正执行，而是暂时保存在Redis中。如果此时另一个客户端执行<code>sismember user:a:follow user:b</code>返回结果应该为0。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember user:a:follow user:b
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><p>只有当<code>exec</code>执行完成后，事务操作才算完成。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><p>此时再次执行<code>sismember user:a:follow user:b</code>命令，命令才不会返回0。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> sismember user:a:follow user:b
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><p>如果要停止事务的执行，可以使用<code>discard</code>命令代替exec命令即可。</p> <h3 id="redis事务错误处理机制"><a href="#redis事务错误处理机制" class="header-anchor">#</a> Redis事务错误处理机制</h3> <p>若Redis事务发生错误，Redis事务对于不同错误处理的方式不一样。</p> <ul><li><strong>命令错误</strong>：若错误属于命令错误，则整个事务将无法执行。</li> <li><strong>运行时错误</strong>：若错误属于运行时错误，例如语法正确，但本因使用集合的，使用了有序集合，则事务将继续执行。</li></ul> <p><strong>可以看到Redis并不支持回滚功能，若错误属于运行时错误，则需要开发人员自己解决。</strong></p> <p>有些应用场景需要在事务之前，确保事务中的key没有被其他客户端修改过，才执行事务，否则不执行（类似乐观锁）。Redis提供了watch命令来解决这类问题。</p> <p>Redis提供的事务比较简单，之所以说它简单，主要是因为它不支持事务中的回滚特性，同时无法实现命令之间的逻辑关系计算。</p> <h2 id="redis中的bitmaps"><a href="#redis中的bitmaps" class="header-anchor">#</a> Redis中的Bitmaps</h2> <p>现代计算机用二进制（位）作为信息的基础单位，1个字节等于8位，例如“big”字符串是由3个字节组成，但实际在计算机存储时将其用二进制表示，“big”分别对应的ASCII码分别是98、105、103，对应的二进制分别是
01100010、01101001和01100111。</p> <p>许多开发语言都提供了操作位的功能，合理地使用位能够有效地提高内存使用率和开发效率。Redis提供了Bitmaps这个“数据结构”可以实现对位的操作。对于Bitmaps，我们需要注意两点：</p> <ul><li>Bitmaps本身不是一种数据结构，实际上它就是字符串，但是它可以对字符串的位进行操作。</li> <li>Bitmaps单独提供了一套命令，所以在Redis中使用Bitmaps和使用字符串的方法不太相同。可以把Bitmaps想象成一个以位为单位的数组， <strong>数组的每个单元只能存储0和1，数组的下标在Bitmaps中叫做偏移量</strong> 。</li></ul> <h3 id="bitmaps设置值"><a href="#bitmaps设置值" class="header-anchor">#</a> Bitmaps设置值</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>setbit key offset value
</code></pre></div><h3 id="bitmaps获取值"><a href="#bitmaps获取值" class="header-anchor">#</a> Bitmaps获取值</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>gitbit key offset
</code></pre></div><h3 id="获取bitmaps指定范围值为1的个数"><a href="#获取bitmaps指定范围值为1的个数" class="header-anchor">#</a> 获取Bitmaps指定范围值为1的个数</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>bitcount <span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">[</span>end<span class="token punctuation">]</span>
</code></pre></div><p>其中，[start]和[end]代表的是起始和结束的字节数。</p> <h3 id="bitmaps间的运算"><a href="#bitmaps间的运算" class="header-anchor">#</a> Bitmaps间的运算</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>bitop <span class="token function">op</span> destkey key<span class="token punctuation">[</span>key<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">]</span>
</code></pre></div><p>bitop是一个复合操作，它可以做多个Bitmaps的and（交集）、or（并集）、not（非）、xor（异或）操作并将结果保存在destkey中。</p> <h3 id="计算bitmaps中第一个值为targetbit的偏移量"><a href="#计算bitmaps中第一个值为targetbit的偏移量" class="header-anchor">#</a> 计算Bitmaps中第一个值为targetBit的偏移量</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>bitpos key targetBit <span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token punctuation">[</span>end<span class="token punctuation">]</span>
</code></pre></div><p>除此之外，bitops有两个选项[start]和[end]，分别代表起始字节和结束字节。</p> <h2 id="redis中的hyperloglog"><a href="#redis中的hyperloglog" class="header-anchor">#</a> Redis中的HyperLogLog</h2> <p>HyperLogLog并不是一种新的数据结构（实际类型为字符串类型），而是一种基数算法，通过HyperLogLog可以利用极小的内存空间完成独立总数的统计，数据集可以是IP、Email、ID等。HyperLogLog提供了3个命令：
<code>pfadd</code>、<code>pfcount</code>、<code>pfmerge</code>。</p> <h3 id="添加指定元素到-hyperloglog-中"><a href="#添加指定元素到-hyperloglog-中" class="header-anchor">#</a> 添加指定元素到 HyperLogLog 中</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pfadd key element <span class="token punctuation">[</span>element …<span class="token punctuation">]</span>
</code></pre></div><p>pfadd用于向HyperLogLog添加元素，如果添加成功返回1。</p> <h3 id="计算独立用户数"><a href="#计算独立用户数" class="header-anchor">#</a> 计算独立用户数</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pfcount key <span class="token punctuation">[</span>key …<span class="token punctuation">]</span>
</code></pre></div><p>pfcount用于计算一个或多个HyperLogLog的独立总数。</p> <h3 id="合并hyperloglog元素"><a href="#合并hyperloglog元素" class="header-anchor">#</a> 合并HyperLogLog元素</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pfmerge destkey sourcekey <span class="token punctuation">[</span>sourcekey <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>pfmerge可以求出多个HyperLogLog的并集并赋值给destkey。</p> <p>HyperLogLog内存占用量非常小，但是存在错误率，开发者在进行数据结构选型时只需要确认如下两条：</p> <ul><li>只为了计算独立总数，不需要获取单条数据。</li> <li>可以容忍一定误差率，毕竟HyperLogLog在内存的占用量上有很大的优势。</li></ul> <h2 id="redis发布-订阅模式"><a href="#redis发布-订阅模式" class="header-anchor">#</a> Redis发布-订阅模式</h2> <p>Redis提供了基于“发布/订阅”模式的消息机制，<strong>此种模式下，消息发布者和订阅者不进行直接通信，发布者客户端向指定的频道（channel）发布消息，订阅该频道的每个客户端都可以收到该消息。</strong> Redis提供了若干命令支持该功能，在实际应用开发时，能够为此类问题提供实现方法。</p> <p>Redis主要提供了发布消息、订阅频道、取消订阅以及按照模式订阅和取消订阅等命令。</p> <h3 id="发布消息命令"><a href="#发布消息命令" class="header-anchor">#</a> 发布消息命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>publish channel message
</code></pre></div><p>下面操作会向channel：sports频道发布一条消息“Tim won the championship”， <strong>返回结果为订阅者个数</strong> ，因为此时没有订阅，所以返回结果为0。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish channel:sports <span class="token string">&quot;Tim won the championship&quot;</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><h3 id="订阅消息命令"><a href="#订阅消息命令" class="header-anchor">#</a> 订阅消息命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>subscribe channel <span class="token punctuation">[</span>channel <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>订阅者可以订阅一个或多个频道，下面操作为当前客户端订阅了<code>channel:sports</code>频道。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>subscribe channel:sports
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><p>此时另一个客户端发布一条消息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>publish channel:sports <span class="token string">&quot;James lost the championship&quot;</span>
</code></pre></div><p>当前订阅者客户端会收到如下消息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>subscribe channel:sports
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;subscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;message&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;James lost the championship&quot;</span>
</code></pre></div><p>有关订阅命令有两点需要注意：</p> <ul><li>客户端在执行订阅命令之后进入了订阅状态，只能接收<code>subscribe</code>、<code>psubscribe</code>、<code>unsubscribe</code>、<code>punsubscribe</code>的四个命令。</li> <li><strong>新开启的订阅客户端，无法收到该频道之前的消息</strong> ，因为Redis不会对发布的消息进行持久化。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>和很多专业的消息队列系统（例如Kafka、RocketMQ）相比，Redis的发布订阅略显粗糙。</p></div> <h3 id="取消订阅命令"><a href="#取消订阅命令" class="header-anchor">#</a> 取消订阅命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>unsubscribe <span class="token punctuation">[</span>channel <span class="token punctuation">[</span>channel <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>客户端可以通过unsubscribe命令取消对指定频道的订阅，取消成功后，不会再收到该频道的发布消息。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> unsubscribe channel:sports
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;unsubscribe&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><h3 id="按照模式订阅和取消订阅"><a href="#按照模式订阅和取消订阅" class="header-anchor">#</a> 按照模式订阅和取消订阅</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>psubscribe pattern <span class="token punctuation">[</span>pattern<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
punsubscribe <span class="token punctuation">[</span>pattern <span class="token punctuation">[</span>pattern <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>除了<code>subcribe</code>和<code>unsubscribe</code>命令，Redis命令还支持glob风格的订阅命令<code>psubscribe</code>和取消订阅命令<code>punsubscribe</code>。</p> <h3 id="查询订阅命令-查看活跃的频道"><a href="#查询订阅命令-查看活跃的频道" class="header-anchor">#</a> 查询订阅命令-查看活跃的频道</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pubsub channels <span class="token punctuation">[</span>pattern<span class="token punctuation">]</span>
</code></pre></div><p>所谓活跃的频道是指当前频道至少有一个订阅者，其中[pattern]是可以指定具体的模式：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pubsub channels
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
</code></pre></div><h3 id="查看订阅命令-查看频道订阅数"><a href="#查看订阅命令-查看频道订阅数" class="header-anchor">#</a> 查看订阅命令-查看频道订阅数</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pubsub numsub <span class="token punctuation">[</span>channel <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>现在，我们来查看<code>channel:sports</code>频道的订阅数。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pubsub numsub channel:sports
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;channel:sports&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><h3 id="查看订阅命令-查看模式订阅数"><a href="#查看订阅命令-查看模式订阅数" class="header-anchor">#</a> 查看订阅命令-查看模式订阅数</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pubsub numpat
</code></pre></div><p>由于我们没有<code>psubscribe</code>命令，所以我们没有安装模式订阅的频道。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> pubsub numpat
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><h2 id="redis地理信息定位-geo"><a href="#redis地理信息定位-geo" class="header-anchor">#</a> Redis地理信息定位-GEO</h2> <p>Redis3.2版本提供了GEO（地理信息定位）功能，支持存储地理位置信 息用来实现诸如附近位置、摇一摇这类依赖于地理位置信息的功能。</p> <h3 id="增加地理位置信息"><a href="#增加地理位置信息" class="header-anchor">#</a> 增加地理位置信息</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>geoadd key longitude latitude member <span class="token punctuation">[</span>longitude latitude member <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>longitude、latitude、member分别是该地理位置的经度、纬度、成员。下表展示了5个城市的经纬度。</p> <table><thead><tr><th style="text-align:center;">城市</th> <th style="text-align:center;">经度</th> <th style="text-align:center;">纬度</th> <th style="text-align:center;">成员</th></tr></thead> <tbody><tr><td style="text-align:center;">北京</td> <td style="text-align:center;">116.28</td> <td style="text-align:center;">39.55</td> <td style="text-align:center;">beijing</td></tr> <tr><td style="text-align:center;">天津</td> <td style="text-align:center;">117.12</td> <td style="text-align:center;">39.08</td> <td style="text-align:center;">tianjin</td></tr> <tr><td style="text-align:center;">石家庄</td> <td style="text-align:center;">114.29</td> <td style="text-align:center;">38.02</td> <td style="text-align:center;">shijiazhuang</td></tr> <tr><td style="text-align:center;">唐山</td> <td style="text-align:center;">118.01</td> <td style="text-align:center;">39.38</td> <td style="text-align:center;">tangshan</td></tr> <tr><td style="text-align:center;">保定</td> <td style="text-align:center;">115.29</td> <td style="text-align:center;">38.51</td> <td style="text-align:center;">baoding</td></tr></tbody></table> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd cities:locations  <span class="token number">116.28</span> <span class="token number">39.55</span> beijing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><p>返回结果代表添加成功的个数，如果cities：locations没有包含beijing，那么返回结果为1，如果已经存在则返回0。</p> <h3 id="更新地理位置信息"><a href="#更新地理位置信息" class="header-anchor">#</a> 更新地理位置信息</h3> <p>如果需要更新地理位置信息，仍然可以使用<code>geoadd</code>命令，虽然返回结果为0。<code>geoadd</code>命令可以同时添加多个地理位置信息。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geoadd cities:locations <span class="token number">117.12</span> <span class="token number">39.08</span> tianjin <span class="token number">114.29</span> <span class="token number">38.02</span> shijiazhuang <span class="token number">118.01</span> <span class="token number">39.38</span> tangshan <span class="token number">115.29</span> <span class="token number">38.51</span> baoding
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre></div><h3 id="获取地理位置信息"><a href="#获取地理位置信息" class="header-anchor">#</a> 获取地理位置信息</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>geopos key member <span class="token punctuation">[</span>member <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>下面操作会获取天津的经维度：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geopos cities:locations tianjin
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;117.12000042200088501&quot;</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;39.0800000535766543&quot;</span>
</code></pre></div><h3 id="获取两个地理位置的距离"><a href="#获取两个地理位置的距离" class="header-anchor">#</a> 获取两个地理位置的距离</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>geodist key member1 member2 <span class="token punctuation">[</span>unit<span class="token punctuation">]</span>
</code></pre></div><p>其中unit代表返回结果的单位，包含以下四种：</p> <ul><li>m（meters）代表米。</li> <li>km（kilometers）代表公里。</li> <li>mi（miles）代表英里。</li> <li>ft（feet）代表尺。</li></ul> <p>下面命令可以计算天津到北京的距离，并以公里为单位：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geodist cities:locations tianjin beijing km
<span class="token string">&quot;89.2061&quot;</span>
</code></pre></div><h3 id="获取指定位置范围内的地理信息位置集合"><a href="#获取指定位置范围内的地理信息位置集合" class="header-anchor">#</a> 获取指定位置范围内的地理信息位置集合</h3> <p>获取指定位置范围内的地理信息位置集合的命令总共有两个：<code>georadius</code>和<code>georadiusbymember</code>命令。</p> <ul><li><code>georadius</code>命令</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>georadius key longitude latitude radius m<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span> <span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token punctuation">[</span>withhash<span class="token punctuation">]</span> <span class="token punctuation">[</span>COUNT count<span class="token punctuation">]</span> <span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span> <span class="token punctuation">[</span>store key<span class="token punctuation">]</span> <span class="token punctuation">[</span>storedist key<span class="token punctuation">]</span>
</code></pre></div><ul><li><code>georadiusbymember</code>命令</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>georadiusbymember key member radiusm<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span> <span class="token punctuation">[</span>withdist<span class="token punctuation">]</span>
<span class="token punctuation">[</span>withhash<span class="token punctuation">]</span> <span class="token punctuation">[</span>COUNT count<span class="token punctuation">]</span> <span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span> <span class="token punctuation">[</span>store key<span class="token punctuation">]</span> <span class="token punctuation">[</span>storedist key<span class="token punctuation">]</span>
</code></pre></div><p><code>georadius</code>和<code>georadiusbymember</code>两个命令的作用是一样的，都是以一个地 理位置为中心算出指定半径内的其他地理信息位置，</p> <p>不同的是<code>georadius</code>命令的中心位置给出了具体的经纬度，<code>georadiusbymember</code>只需给出成员即可。其中<code>radiusm|km|ft|mi</code>是必需参数，指定了半径（带单位）。</p> <p>这两个命令有很多可选参数：</p> <ul><li><p>withcoord：返回结果中包含经纬度。</p></li> <li><p>withdist：返回结果中包含离中心节点位置的距离。</p></li> <li><p>withhash：返回结果中包含geohash，有关geohash后面介绍。</p></li> <li><p>COUNT count：指定返回结果的数量。</p></li> <li><p>asc|desc：返回结果按照离中心节点的距离做升序或者降序。</p></li> <li><p>store key：将返回结果的地理位置信息保存到指定键。</p></li> <li><p>storedist key：将返回结果离中心节点的距离保存到指定键。</p></li></ul> <p>下面操作计算五座城市中，距离北京150公里以内的城市。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> georadiusbymember cities:locations beijing <span class="token number">150</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;beijing&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;tianjin&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;tangshan&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;baoding&quot;</span>
</code></pre></div><h3 id="获取地理位置的hash值"><a href="#获取地理位置的hash值" class="header-anchor">#</a> 获取地理位置的hash值</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>geohash key member <span class="token punctuation">[</span>member <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><p>Redis使用<code>geohash</code>将二维经纬度转换为一维字符串，下面操作会返回beijing的geohash值。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> geohash cities:locations beijing
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;wx48ypbe2q0&quot;</span>
</code></pre></div><p>geohash有如下特点：</p> <ul><li><p>·GEO的数据类型为zset，Redis将所有地理位置信息的geohash存放在zset 中。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">type</span> cities:locations
zset
</code></pre></div></li> <li><p>字符串越长，表示的位置更精确。</p></li> <li><p>·两个字符串越相似，它们之间的距离越近，Redis利用字符串前缀匹配 算法实现相关的命令。</p></li> <li><p>geohash编码和经纬度是可以相互转换的。</p></li></ul> <h3 id="删除地理位置信息"><a href="#删除地理位置信息" class="header-anchor">#</a> 删除地理位置信息</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>zrem key member
</code></pre></div><p>GEO没有提供删除成员的命令，但是因为GEO的底层实现是zset，所以可以借用zrem命令实现对地理位置信息的删除。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">3/11/2021, 7:31:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mr-muggle/数据库/Redis/API的理解和使用.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        API的理解和使用
      </a></span> <span class="next"><a href="/mr-muggle/数据库/Redis/Redis客户端.html">
        Redis客户端
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#redis的一些小功能" title="Redis的一些小功能" class="ant-anchor-link-title">Redis的一些小功能</a></div><div class="ant-anchor-link"><a href="#redis慢查询分析" title="Redis慢查询分析" class="ant-anchor-link-title">Redis慢查询分析</a><div class="ant-anchor-link"><a href="#redis慢查询配置参数" title="Redis慢查询配置参数" class="ant-anchor-link-title">Redis慢查询配置参数</a></div><div class="ant-anchor-link"><a href="#修改redis配置参数" title="修改Redis配置参数" class="ant-anchor-link-title">修改Redis配置参数</a></div><div class="ant-anchor-link"><a href="#获取慢查询日志" title="获取慢查询日志" class="ant-anchor-link-title">获取慢查询日志</a></div><div class="ant-anchor-link"><a href="#获取慢查询日志列表当前的长度" title="获取慢查询日志列表当前的长度" class="ant-anchor-link-title">获取慢查询日志列表当前的长度</a></div><div class="ant-anchor-link"><a href="#慢查询日志重置" title="慢查询日志重置" class="ant-anchor-link-title">慢查询日志重置</a></div><div class="ant-anchor-link"><a href="#慢查询最佳实践" title="慢查询最佳实践" class="ant-anchor-link-title">慢查询最佳实践</a></div></div><div class="ant-anchor-link"><a href="#redis官方提供的shell工具" title="Redis官方提供的Shell工具" class="ant-anchor-link-title">Redis官方提供的Shell工具</a><div class="ant-anchor-link"><a href="#shell工具之redis-cli" title="Shell工具之redis-cli" class="ant-anchor-link-title">Shell工具之redis-cli</a></div><div class="ant-anchor-link"><a href="#shell工具之redis-server" title="Shell工具之redis-server" class="ant-anchor-link-title">Shell工具之redis-server</a></div><div class="ant-anchor-link"><a href="#shell工具之redis-benchmark" title="Shell工具之redis-benchmark" class="ant-anchor-link-title">Shell工具之redis-benchmark</a></div></div><div class="ant-anchor-link"><a href="#redis的pipeline机制" title="Redis的Pipeline机制" class="ant-anchor-link-title">Redis的Pipeline机制</a><div class="ant-anchor-link"><a href="#redis使用pipeline" title="Redis使用Pipeline" class="ant-anchor-link-title">Redis使用Pipeline</a></div><div class="ant-anchor-link"><a href="#原生批量命令与pipeline对比" title="原生批量命令与Pipeline对比" class="ant-anchor-link-title">原生批量命令与Pipeline对比</a></div><div class="ant-anchor-link"><a href="#pipeline最佳实践" title="Pipeline最佳实践" class="ant-anchor-link-title">Pipeline最佳实践</a></div></div><div class="ant-anchor-link"><a href="#redis事务功能概述" title="Redis事务功能概述" class="ant-anchor-link-title">Redis事务功能概述</a><div class="ant-anchor-link"><a href="#redis事务基本用法" title="Redis事务基本用法" class="ant-anchor-link-title">Redis事务基本用法</a></div><div class="ant-anchor-link"><a href="#redis事务错误处理机制" title="Redis事务错误处理机制" class="ant-anchor-link-title">Redis事务错误处理机制</a></div></div><div class="ant-anchor-link"><a href="#redis中的bitmaps" title="Redis中的Bitmaps" class="ant-anchor-link-title">Redis中的Bitmaps</a><div class="ant-anchor-link"><a href="#bitmaps设置值" title="Bitmaps设置值" class="ant-anchor-link-title">Bitmaps设置值</a></div><div class="ant-anchor-link"><a href="#bitmaps获取值" title="Bitmaps获取值" class="ant-anchor-link-title">Bitmaps获取值</a></div><div class="ant-anchor-link"><a href="#获取bitmaps指定范围值为1的个数" title="获取Bitmaps指定范围值为1的个数" class="ant-anchor-link-title">获取Bitmaps指定范围值为1的个数</a></div><div class="ant-anchor-link"><a href="#bitmaps间的运算" title="Bitmaps间的运算" class="ant-anchor-link-title">Bitmaps间的运算</a></div><div class="ant-anchor-link"><a href="#计算bitmaps中第一个值为targetbit的偏移量" title="计算Bitmaps中第一个值为targetBit的偏移量" class="ant-anchor-link-title">计算Bitmaps中第一个值为targetBit的偏移量</a></div></div><div class="ant-anchor-link"><a href="#redis中的hyperloglog" title="Redis中的HyperLogLog" class="ant-anchor-link-title">Redis中的HyperLogLog</a><div class="ant-anchor-link"><a href="#添加指定元素到-hyperloglog-中" title="添加指定元素到 HyperLogLog 中" class="ant-anchor-link-title">添加指定元素到 HyperLogLog 中</a></div><div class="ant-anchor-link"><a href="#计算独立用户数" title="计算独立用户数" class="ant-anchor-link-title">计算独立用户数</a></div><div class="ant-anchor-link"><a href="#合并hyperloglog元素" title="合并HyperLogLog元素" class="ant-anchor-link-title">合并HyperLogLog元素</a></div></div><div class="ant-anchor-link"><a href="#redis发布-订阅模式" title="Redis发布-订阅模式" class="ant-anchor-link-title">Redis发布-订阅模式</a><div class="ant-anchor-link"><a href="#发布消息命令" title="发布消息命令" class="ant-anchor-link-title">发布消息命令</a></div><div class="ant-anchor-link"><a href="#订阅消息命令" title="订阅消息命令" class="ant-anchor-link-title">订阅消息命令</a></div><div class="ant-anchor-link"><a href="#取消订阅命令" title="取消订阅命令" class="ant-anchor-link-title">取消订阅命令</a></div><div class="ant-anchor-link"><a href="#按照模式订阅和取消订阅" title="按照模式订阅和取消订阅" class="ant-anchor-link-title">按照模式订阅和取消订阅</a></div><div class="ant-anchor-link"><a href="#查询订阅命令-查看活跃的频道" title="查询订阅命令-查看活跃的频道" class="ant-anchor-link-title">查询订阅命令-查看活跃的频道</a></div><div class="ant-anchor-link"><a href="#查看订阅命令-查看频道订阅数" title="查看订阅命令-查看频道订阅数" class="ant-anchor-link-title">查看订阅命令-查看频道订阅数</a></div><div class="ant-anchor-link"><a href="#查看订阅命令-查看模式订阅数" title="查看订阅命令-查看模式订阅数" class="ant-anchor-link-title">查看订阅命令-查看模式订阅数</a></div></div><div class="ant-anchor-link"><a href="#redis地理信息定位-geo" title="Redis地理信息定位-GEO" class="ant-anchor-link-title">Redis地理信息定位-GEO</a><div class="ant-anchor-link"><a href="#增加地理位置信息" title="增加地理位置信息" class="ant-anchor-link-title">增加地理位置信息</a></div><div class="ant-anchor-link"><a href="#更新地理位置信息" title="更新地理位置信息" class="ant-anchor-link-title">更新地理位置信息</a></div><div class="ant-anchor-link"><a href="#获取地理位置信息" title="获取地理位置信息" class="ant-anchor-link-title">获取地理位置信息</a></div><div class="ant-anchor-link"><a href="#获取两个地理位置的距离" title="获取两个地理位置的距离" class="ant-anchor-link-title">获取两个地理位置的距离</a></div><div class="ant-anchor-link"><a href="#获取指定位置范围内的地理信息位置集合" title="获取指定位置范围内的地理信息位置集合" class="ant-anchor-link-title">获取指定位置范围内的地理信息位置集合</a></div><div class="ant-anchor-link"><a href="#获取地理位置的hash值" title="获取地理位置的hash值" class="ant-anchor-link-title">获取地理位置的hash值</a></div><div class="ant-anchor-link"><a href="#删除地理位置信息" title="删除地理位置信息" class="ant-anchor-link-title">删除地理位置信息</a></div></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/34.112b9f11.js" defer></script>
  </body>
</html>