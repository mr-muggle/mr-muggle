<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Redux入门 | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/61.d314066d.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/25.0536eb3c.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/27.10fbd948.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/34.112b9f11.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/41.ef41848b.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/91.0823b62f.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/编程实践/WEB前端开发/React/React初探.html" title="React初探" class="sidebar-link">React初探</a></li><li><a href="/mr-muggle/编程实践/WEB前端开发/React/React基础精讲.html" title="React基础精讲" class="sidebar-link">React基础精讲</a></li><li><a href="/mr-muggle/编程实践/WEB前端开发/React/React高级内容.html" title="React高级内容" class="sidebar-link">React高级内容</a></li><li><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html" title="Redux入门" class="active sidebar-link">Redux入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#redux概念简述" title="Redux概念简述" class="sidebar-link">Redux概念简述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#redux的设计理念" title="Redux的设计理念" class="sidebar-link">Redux的设计理念</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#redux的构成" title="Redux的构成" class="sidebar-link">Redux的构成</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#redux的工作流程" title="Redux的工作流程" class="sidebar-link">Redux的工作流程</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#使用antd实现todolist" title="使用Antd实现TodoList" class="sidebar-link">使用Antd实现TodoList</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#创建redux的store" title="创建Redux的Store" class="sidebar-link">创建Redux的Store</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#action和reducer的编写" title="Action和Reducer的编写" class="sidebar-link">Action和Reducer的编写</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#使用redux完成todolist" title="使用Redux完成TodoList" class="sidebar-link">使用Redux完成TodoList</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#actiontypes的拆分" title="ActionTypes的拆分" class="sidebar-link">ActionTypes的拆分</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#使用action-creators统一创建action" title="使用Action Creators统一创建action" class="sidebar-link">使用Action Creators统一创建action</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux入门.html#redux设计和使用三原则" title="Redux设计和使用三原则" class="sidebar-link">Redux设计和使用三原则</a></li></ul></li><li><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux进阶.html" title="Redux进阶" class="sidebar-link">Redux进阶</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="redux概念简述"><a href="#redux概念简述" class="header-anchor">#</a> Redux概念简述</h2> <p>通过前面的学习，我们已经可以编写简单的页面了。由于React只是一个非常简单的轻量级视图层框架。当一个项目存在非常多的组件的时候，组件间传值将会非常麻烦，代码可维护性非常差。</p> <p><img src="/react-begin/redux/%E5%AD%98%E5%9C%A8%E4%B8%8E%E4%B8%8D%E5%AD%98%E5%9C%A8Redux%E6%AF%94%E8%BE%83.png" alt="存在与不存在Redux比较.png"></p> <p>如果我们想要编写一个大型的项目，我们需要给React搭配一个数据层框架，一般我们使用数据层框架Redux。</p> <h3 id="redux的设计理念"><a href="#redux的设计理念" class="header-anchor">#</a> Redux的设计理念</h3> <p>正如上图所示，假设绿色的组件需要向其它组件传值，通过Redux，我们可以将数据存放到一个公共的区域<code>Store</code>里面，当绿色组件需要改变数据传递给其它组件时，绿色组件只需要更改<code>Store</code>里面对应的数据就行了。灰色组件会自动感知<code>Store</code>里的数据变化，重新从<code>Store</code>里获取数据。这样，绿色组件就很方便地将数据传递给其它组件了。不管组件的层次有多深，他们所走的流程都是一样的。组件改变数据，其它组件重新获取数据，通过这样的设计理念，大大简化了数据传递。</p> <h3 id="redux的构成"><a href="#redux的构成" class="header-anchor">#</a> Redux的构成</h3> <p>Redux的构成实际上可以分为两部分：</p> <blockquote><p>Redux = Reducer + Flux</p></blockquote> <p>实际上，Flux是React官方提供的最原始的数据层框架，只是在使用过程中发现了一些弊端，因此有人将Flux整合Reducer升级成了Redux。</p> <h2 id="redux的工作流程"><a href="#redux的工作流程" class="header-anchor">#</a> Redux的工作流程</h2> <p>在学习使用Redux之前，我们需要了解一下Redux的工作流程。</p> <p><img src="/react-begin/redux/Redux%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="Redux工作流程"></p> <p>上图是Redux的工作流程图例。上一节讲过，Redux是一个数据层框架，它把所有的数据都放到了store当中。</p> <p>每个组件都可以从store中获取和修改数据。所以我们就知道了，<code>React Compents</code>就是React中的组件，<code>Store</code>就是存放数据的公共区域。那么<code>Action Creators</code>和<code>Reducers</code>代表的是什么呢？为了理解这个问题，我们做如下比喻，将其比作一个图书馆的流程：</p> <ul><li><code>React Components</code>：代表的是一个借书的用户。</li> <li><code>Action Creators</code>：代表的是借书时向图书管理员传递的数据。</li> <li><code>Store</code>：代表的是图书馆的管理员，管理整个图书馆</li> <li><code>Reducers</code>：一个图书馆管理员是无法记住所有的书籍的，<code>Reducers</code>就相当于一个记录本，记载的是关于图书的信息。</li></ul> <p>所以整个流程就是：</p> <ul><li>首先，借书人(<code>React Components</code>)向图书馆管理员传递的信息(<code>Action Creators</code>)</li> <li>接着，图书馆管理员查阅记录本<code>Reducers</code>，<code>Reducers</code>记录了要借书籍的信息</li> <li>然后，管理员通过书籍信息查询到相应的书籍</li> <li>最后，管理员将借书人需要的书交给借书人</li></ul> <p>将图书馆流程转换为Redux的工作流程：</p> <ol><li>首先，我有一个组件，这个组件从<code>Store</code>中获取所需数据</li> <li>接着，组件通过<code>Action Creators</code>传递action给<code>Store</code></li> <li><code>Store</code>接受action后，从<code>Reducers</code>中获取数据并交由<code>Store</code>返回给组件</li></ol> <p>若我们需要改变数据也是一样的，组件通过<code>Action Creators</code>将action传递给<code>Store</code>；接着，<code>Store</code>根据情况从<code>Reducers</code>了解到该如何修改数据；当<code>Store</code>完成相应的数据修改后，通知组件重新获取数据；最后，组件从<code>Store</code>重新获取数据。</p> <h2 id="使用antd实现todolist"><a href="#使用antd实现todolist" class="header-anchor">#</a> 使用Antd实现TodoList</h2> <p>从本节开始，我们将使用React结合Redux重新编写<code>TodoList</code>功能，并且我们还将使用Antd这个UI框架完成一个较为美观的页面。</p> <p>新建一个分支，删除<code>src</code>目录下除了<code>index.js</code>文件之外的其它文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TodoList <span class="token keyword">from</span> <span class="token string">'./TodoList'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>TodoList <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>创建<code>TodoList.js</code>文件编写<code>TodoList</code>组件。</p> <p>首先，我们安装一下这个UI框架：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> antd
</code></pre></div><p>接着，我们来编写<code>TodoList</code>组件的提交和输入框按钮。引入antd样式并引入<code>Input</code>、<code>Button</code>组件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Input<span class="token punctuation">,</span>Button<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginLeft</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList<span class="token punctuation">;</span>
</code></pre></div><p>通过上面的代码，我们完成了按钮和输入框结构和样式的编写。</p> <p><img src="/react-begin/redux/%E8%BE%93%E5%85%A5%E6%A1%86%E5%92%8C%E6%8C%89%E9%92%AE.png" alt="输入框和按钮"></p> <p>然后，我们来编写一下输入框下方的列表。在这里，我们引入使用<code>List</code>组件，设置列表样式。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Input<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>List<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'Racing car sprays burning fuel into crowd.'</span><span class="token punctuation">,</span>
    <span class="token string">'Japanese princess to wed commoner.'</span><span class="token punctuation">,</span>
    <span class="token string">'Australian walks 100km after outback crash.'</span><span class="token punctuation">,</span>
    <span class="token string">'Man charged over missing wedding girl.'</span><span class="token punctuation">,</span>
    <span class="token string">'Los Angeles battles huge wildfires.'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginLeft</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>List
                    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    bordered
                    dataSource<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span>
                    renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList<span class="token punctuation">;</span>
</code></pre></div><p>其中，<code>List</code>组件中<code>bordered</code>属性代表是否有边框；<code>dataSource</code>代表数据来源，这里使用<code>data</code>数据；<code>renderItem</code>循环展示列表中的每一项。</p> <p><img src="/react-begin/redux/%E5%88%97%E8%A1%A8.png" alt="列表"></p> <p>通过以上步骤，我们就完成了<code>TodoList</code>组件基本结构的编写。</p> <h2 id="创建redux的store"><a href="#创建redux的store" class="header-anchor">#</a> 创建Redux的Store</h2> <p>这一节，我们开始编写Redux相关的代码。在Redux中最为重要的是Store，它负责存放组件所用到的所有数据，我们应该优先编写它。</p> <p>首先，我们先来安装一下Redux。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> redux
</code></pre></div><p>其次，我们在<code>src</code>目录下新建<code>store</code>目录并新建一个<code>index.js</code>文件用来编写store代码。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><p>通过<code>createStore()</code>方法，我们创建了一个公共区域用于存放数据。</p> <p>正如在Redux的工作流程一节所比喻的那样：``Store<code>是一个管理员，它需要通过记录本</code>Reducer<code>来帮助其管理图书。因此，我们在</code>Store<code>目录下创建</code>reducer.js`文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inputValue</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Reducer是一个接受参数<code>state</code>和<code>action</code>的函数，其中<code>state</code>代表存放的数据，默认值为<code>defaultState</code>；action代表组件通过<code>Action Creators</code>创建的消息action。</p> <p>修改一下<code>store</code>目录下的<code>index.js</code>文件，将Reducer引入Store帮助管理数据。</p> <div class="language- extra-class"><pre class="language-text"><code>import {createStore} from 'redux';
import reducer from './reducer';

const store = createStore(reducer);

export default store;
</code></pre></div><p>接下来，修改<code>TodoList</code>组件代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Input<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>List<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginLeft</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Input  placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>List
                    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    bordered
                    dataSource<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
                    renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList<span class="token punctuation">;</span>
</code></pre></div><p>在<code>TodoList</code>组件中，我们引入<code>Store</code>，删除data常量，将列表设为空数组；增加构造函数并打印<code>store.getState()</code>。</p> <p><img src="/react-begin/redux/store%E5%8A%9F%E8%83%BD.png" alt="store功能"></p> <p>为了进一步测试，我们先修改<code>reducer.js</code>文件，给<code>defaultState</code>中的变量赋予默认值。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inputValue</span><span class="token operator">:</span><span class="token string">'123'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，在构造函数中将<code>store.getState()</code>中数据赋值<code>this.state</code>并将<code>this.state</code>中对应的值分别绑定到输入框和列表中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Input<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>List<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginLeft</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">}</span> placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>List
                    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    bordered
                    dataSource<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">}</span>
                    renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList<span class="token punctuation">;</span>
</code></pre></div><p>运行项目，可以看到输入框和列表已经成功绑定了数据。</p> <p><img src="/react-begin/redux/store%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE.png" alt="store返回数据"></p> <h2 id="action和reducer的编写"><a href="#action和reducer的编写" class="header-anchor">#</a> Action和Reducer的编写</h2> <p>上一节，我们已经完成了创建Store和从Store取数据的功能。这一节我们开始编写Action和Reducer的相关代码。</p> <p>我们先来安装一个Chrome插件<code>Redux DevTools</code>。可以通过谷歌访问助手或者其它方式到谷歌商店搜索下载。安装完毕后，打开谷歌开发者工具可以看到Redux标签。</p> <p><img src="/react-begin/redux/%E8%B0%B7%E6%AD%8C%E6%8F%92%E4%BB%B6Redux%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7.png" alt="谷歌插件Redux开发工具"></p> <p>Redux标签提示没有找到store，点击<code>the instructions</code>进行配置，它需要我们在创建store时在<code>createStore</code>方法指定第二个参数的值为<code>window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span>window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__ <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
</code></pre></div><p>这句话表示若存在<code>Redux DevTools</code>扩展则启用该扩展。重新刷新页面，Redux标签下出现如下面板，选择<code>State</code>子标签页，<code>Store</code>里的数据一目了然。</p> <p><img src="/react-begin/redux/%E8%B0%B7%E6%AD%8C%E6%8F%92%E4%BB%B6Redux%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E9%9D%A2%E6%9D%BF.png" alt="谷歌插件Redux开发工具面板"></p> <p>前一节，我们已经编写了<code>Store</code>和<code>Reducer</code>，让React中的组件能从<code>Store</code>获取数据，这一节我们尝试改变<code>Store</code>里的数据。</p> <p><img src="/react-begin/redux/Redux%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="Redux工作流程"></p> <p>假设我是一个借书的同学，我需要说一句话（action），这句话由<code>Action Creators</code>帮忙创建，我们先把<code>Action Creactors</code>忽略，先创建这句话（即action）。</p> <p>当我们改变输入框中的内容时，我们希望Store中的<code>inputValue</code>值也跟着变，因此我们对输入框绑定一个change事件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">}</span> placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                    onChange <span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleInputChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>在这个处理事件函数中，我们定义一个action，指定其类型以及要传递的值。<code>Store</code>提供了<code>dispatch</code>方法，通过该方法我们可以将action传递给Store。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'change_input_value'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token punctuation">}</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>前面我们说过，Store相当于一个管理员，需要借助<code>Reducer</code>才能知道如何处理数据。当<code>Store</code>接收到action后，将把Store存放的值和action一起转发给<code>Reducer</code>，<code>Reducer</code>根据传递给它的存放在<code>Store</code>中的值和当前的action做出相应的处理并返回新的值给<code>Store</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'change_input_value'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> action<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这段代码中，我们深拷贝了<code>state</code>数据<code>newState</code>，并使用action中传递的value替代了<code>newState</code>中的<code>inputValue</code>值。</p> <div class="custom-block tip"><p class="custom-block-title">提醒</p> <p>reducer可以接受state，但不能修改state数据。</p></div> <p><code>Store</code>会接受<code>Reducer</code>返回的数据并用返回的数据替代存储的旧数据。</p> <p>我们测试一下代码的正确性。在输入框中改变内容为&quot;123a&quot;。</p> <p><img src="/react-begin/redux/%E6%94%B9%E5%8F%98%E8%BE%93%E5%85%A5%E6%A1%86%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="改变输入框中的数据"></p> <p>可以看到Store中的值已经改变，但是输入框中的内容没有变，即组件并没有更新。因此，我们需要在<code>TodoList</code>组件的构造函数方法中调用<code>store.subscribe()</code>方法订阅<code>Store</code>。<code>subscribe</code>方法里可以指定一个函数，当<code>Store</code>里的数据发生改变时，从<code>Store</code>里重新获取数据并更新组件数据的值。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleInputChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleInputChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleStoreChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleStoreChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<code>handleStoreChange</code>方法用来更新组件的数据。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">handleStoreChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再次进行测试，此时输入框和<code>Store</code>里的数据产生了联动效果。</p> <p><img src="/react-begin/redux/store%E5%92%8C%E8%BE%93%E5%85%A5%E6%A1%86%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.png" alt="store和输入框数据同步"></p> <p>同理，我们希望点击提交按钮时，数据能够存到<code>Store</code>的<code>list</code>参数里并正常展示。因此，我们绑定一个Click事件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleBtnClick<span class="token punctuation">}</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
</code></pre></div><p>接着，我们定义<code>handleBtnClick</code>函数，和前面一样创建一个action，并将action发送给<code>Store</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">handleBtnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'add_todo_item'</span>
   <span class="token punctuation">}</span>
   store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Store</code>接收到action后，将先前存储的数据和action一起发给Reducer处理。同样地，我们深拷贝先前的数据，更新参数<code>list</code>并将输入框参数<code>inputValue</code>的值置空。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add_todo_item'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newState <span class="token operator">=</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>测试代码，输入内容并点击提交按钮，列表成功添加内容。</p> <p><img src="/react-begin/redux/%E6%8F%90%E4%BA%A4%E8%BE%93%E5%85%A5%E6%A1%86%E5%86%85%E5%AE%B9%E5%88%B0%E5%88%97%E8%A1%A8.png" alt="提交输入框内容到列表"></p> <h2 id="使用redux完成todolist"><a href="#使用redux完成todolist" class="header-anchor">#</a> 使用Redux完成TodoList</h2> <p>在前面的章节中，我们已经完成了<code>TodoList</code>输入内容、添加内容的功能，这一节我们开始完成<code>TodoList</code>删除功能。</p> <p>首先，我们先修改一下<code>reducer.js</code>文件中<code>state</code>参数的默认值，将<code>inputValue</code>设置为空字符串、<code>list</code>设置为空数组。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inputValue</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接着，我们在<code>TodoList</code>组件的<code>List.Item</code>组件上绑定一个Click事件，并传递一个index参数给事件函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token operator">&lt;</span>List
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        bordered
        dataSource<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">}</span>
        renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleItemDelete</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>通过<code>handleItemDelete</code>事件函数，我们发送一个action给<code>Store</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">handleItemDelete</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'delete_todo_item'</span><span class="token punctuation">,</span>
        index
     <span class="token punctuation">}</span>
     store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当<code>Store</code>接收到action后又把它转发给<code>Reducer</code>，因此，我们在<code>reducer.js</code>文件中增加一段代码，用于删除被点击的列表项。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'delete_todo_item'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newState <span class="token operator">=</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newState<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="actiontypes的拆分"><a href="#actiontypes的拆分" class="header-anchor">#</a> ActionTypes的拆分</h2> <p>通过前面的代码，我们已经完成了<code>TodoList</code>的所有功能，现在我们逐步对其进行优化。在<code>TodoList</code>组件和<code>Reducer</code>中我们使用了类似<code>change_input_value</code>、<code>add_todo_item</code>、<code>delete_todo_item</code>的字符串。其实这样做是非常不好的，若我们不幸写错了字符串的字母，程序不会报错，查找错误非常困难。</p> <p>为此，我们在目录<code>store</code>下创建<code>actionTypes.js</code>文件对ActionTypes进行拆分，将字符串定义在一个文件中。当我们写错了字符串字母时，程序会报错，有利于我们查找错误。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">CHANGE_INPUT_VALUE</span> <span class="token operator">=</span> <span class="token string">'change_input_value'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_TODO_ITEM</span> <span class="token operator">=</span> <span class="token string">'add_todo_item'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DELETE_TODO_ITEM</span> <span class="token operator">=</span> <span class="token string">'delete_todo_item'</span><span class="token punctuation">;</span>
</code></pre></div><p>接着·，我们分别在<code>TodoList.js</code>和<code>reducer.js</code>文件中引入ActionTypes。</p> <p>引入<code>TodoList.js</code>文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'antd/dist/antd.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Input<span class="token punctuation">,</span>Button<span class="token punctuation">,</span>List<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">,</span><span class="token constant">ADD_TODO_ITEM</span><span class="token punctuation">,</span><span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store/actionTypes'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleInputChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleInputChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleStoreChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleStoreChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleBtnClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleBtnClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleStoreChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginLeft</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputValue<span class="token punctuation">}</span> placeholder<span class="token operator">=</span><span class="token string">'todo Info'</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span><span class="token punctuation">,</span><span class="token literal-property property">marginRight</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                    onChange <span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleInputChange<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">'primary'</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleBtnClick<span class="token punctuation">}</span> <span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>List
                    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">marginTop</span><span class="token operator">:</span><span class="token string">'10px'</span><span class="token punctuation">,</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token string">'300px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                    bordered
                    dataSource<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">}</span>
                    renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleItemDelete</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">,</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token punctuation">}</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleStoreChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleBtnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD_TODO_ITEM</span>
        <span class="token punctuation">}</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleItemDelete</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
           <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">,</span>
           index
       <span class="token punctuation">}</span>
       store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoList<span class="token punctuation">;</span>
</code></pre></div><p>引入<code>reducer.js</code>文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">,</span><span class="token constant">ADD_TODO_ITEM</span><span class="token punctuation">,</span><span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actionTypes'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inputValue</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> action<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">ADD_TODO_ITEM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newState <span class="token operator">=</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> newState <span class="token operator">=</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newState<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用action-creators统一创建action"><a href="#使用action-creators统一创建action" class="header-anchor">#</a> 使用<code>Action Creators</code>统一创建action</h2> <p>在前面的章节中，我们没有使用<code>Action Creators</code>统一创建action，而是让函数自行创建action。对于小型项目来说这是可行的，对于大型项目则会带来日后代码管理上的不便。</p> <p>首先，我们先在目录<code>store</code>下创建一个<code>actionCreators.js</code>文件，并创建三种不同类型的action对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">,</span><span class="token constant">ADD_TODO_ITEM</span><span class="token punctuation">,</span><span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actionTypes'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getInputChangeAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">CHANGE_INPUT_VALUE</span><span class="token punctuation">,</span>
    value
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAddItemAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ADD_TODO_ITEM</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getDeleteItemAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token constant">DELETE_TODO_ITEM</span><span class="token punctuation">,</span>
    index
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其次，我们在<code>TodoList</code>组件中引入并替换掉在<code>handleInputChange</code>、<code>handleBtnClick</code>、<code>handleItemDelete</code>函数中自行创建的action。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">getInputChangeAction</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleStoreChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleBtnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">getAddItemAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleItemDelete</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token function">getDeleteItemAction</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
       store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>这样，我们就能使用<code>Action Creators</code>统一创建action了。</p> <h2 id="redux设计和使用三原则"><a href="#redux设计和使用三原则" class="header-anchor">#</a> Redux设计和使用三原则</h2> <p>在前面的章节中，Redux基础知识都覆盖到了。下面我们来补充一下Redux设计和使用三原则。</p> <ul><li>store必须是唯一的</li> <li>只有store才能改变自己的内容</li> <li>Reducer必须是纯函数（纯函数是指给定固定的输入，就一定有固定的输出，且不会有任何副作用）</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">7/9/2020, 9:08:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mr-muggle/编程实践/WEB前端开发/React/React高级内容.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        React高级内容
      </a></span> <span class="next"><a href="/mr-muggle/编程实践/WEB前端开发/React/Redux进阶.html">
        Redux进阶
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#redux概念简述" title="Redux概念简述" class="ant-anchor-link-title">Redux概念简述</a><div class="ant-anchor-link"><a href="#redux的设计理念" title="Redux的设计理念" class="ant-anchor-link-title">Redux的设计理念</a></div><div class="ant-anchor-link"><a href="#redux的构成" title="Redux的构成" class="ant-anchor-link-title">Redux的构成</a></div></div><div class="ant-anchor-link"><a href="#redux的工作流程" title="Redux的工作流程" class="ant-anchor-link-title">Redux的工作流程</a></div><div class="ant-anchor-link"><a href="#使用antd实现todolist" title="使用Antd实现TodoList" class="ant-anchor-link-title">使用Antd实现TodoList</a></div><div class="ant-anchor-link"><a href="#创建redux的store" title="创建Redux的Store" class="ant-anchor-link-title">创建Redux的Store</a></div><div class="ant-anchor-link"><a href="#action和reducer的编写" title="Action和Reducer的编写" class="ant-anchor-link-title">Action和Reducer的编写</a></div><div class="ant-anchor-link"><a href="#使用redux完成todolist" title="使用Redux完成TodoList" class="ant-anchor-link-title">使用Redux完成TodoList</a></div><div class="ant-anchor-link"><a href="#actiontypes的拆分" title="ActionTypes的拆分" class="ant-anchor-link-title">ActionTypes的拆分</a></div><div class="ant-anchor-link"><a href="#使用action-creators统一创建action" title="使用Action Creators统一创建action" class="ant-anchor-link-title">使用Action Creators统一创建action</a></div><div class="ant-anchor-link"><a href="#redux设计和使用三原则" title="Redux设计和使用三原则" class="ant-anchor-link-title">Redux设计和使用三原则</a></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/61.d314066d.js" defer></script>
  </body>
</html>