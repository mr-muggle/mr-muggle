(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{683:function(s,t,a){"use strict";a.r(t);var e=a(74),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"redis的一些小功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis的一些小功能"}},[s._v("#")]),s._v(" Redis的一些小功能")]),s._v(" "),t("p",[s._v("Redis提供的5种数据结构已经足够强大，但除此之外，Redis还提供了诸如慢查询分析、功能强大的Redis Shell、Pipeline、事务与Lua脚本、Bitmaps、HyperLogLog、发布订阅、GEO等附加功能，这些功能可以在某些场景发挥重要的作用。")]),s._v(" "),t("h2",{attrs:{id:"redis慢查询分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis慢查询分析"}},[s._v("#")]),s._v(" Redis慢查询分析")]),s._v(" "),t("p",[s._v("许多存储系统（例如MySQL）提供慢查询日志帮助开发和运维人员定位系统存在的慢操作。所谓慢查询日志就是系统在命令执行前后计算每条命令的执行时间，当超过预设阀值，就将这条命令的相关信息（例如：发生时间，耗时，命令的详细信息）记录下来，Redis也提供了类似的功能。")]),s._v(" "),t("p",[s._v("一般来说，我们可以将Redis客户端执行一条命令·的过程拆分为以下四个阶段： "),t("strong",[s._v("发送命令、命令排队、命令执行、返回结果。")]),s._v(" 对于这四个阶段，Redis只统计命令执行这个阶段所耗费的时间。")]),s._v(" "),t("h3",{attrs:{id:"redis慢查询配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis慢查询配置参数"}},[s._v("#")]),s._v(" Redis慢查询配置参数")]),s._v(" "),t("p",[s._v("对于慢查询，我们一般配置两个参数，一个预设阈值，另一个最大日志记录数。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("预设阈值")]),s._v("：配置这个选项就是设置最大超时时间（单位：微秒），当Redis执行命令耗费的时间超过这个预设阈值时，Redis就会记录这个慢查询，可以使用"),t("code",[s._v("slowlog-log-slower-than")]),s._v("参数设置超时时间。该参数默认值是10000。"),t("strong",[s._v("如果"),t("code",[s._v("slowlog-log-slower-than=0")]),s._v("会记录所有的命令，"),t("code",[s._v("slowlog-log-slowerthan<0")]),s._v("对于任何命令都不会进行记录")]),s._v("。")]),s._v(" "),t("li",[t("strong",[s._v("最大日志记录数")]),s._v("：实际上，Redis使用了一个列表来存储慢查询日志，"),t("code",[s._v("slowlog-max-len")]),s._v("参数设置的就是列表的最大长度。当一个新的命令满足慢查询条件时慢查询将被插入到这个列表中，当慢查询日志列表已处于其最大长度时，最早插入的一个命令将从列表中移出。")])]),s._v(" "),t("h3",{attrs:{id:"修改redis配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改redis配置参数"}},[s._v("#")]),s._v(" 修改Redis配置参数")]),s._v(" "),t("p",[s._v("在Redis中有两种修改配置的方法，一种是修改配置文件，另一种是使用"),t("code",[s._v("config set")]),s._v("命令动态修改。例如下面使用"),t("code",[s._v("config set")]),s._v("命令将"),t("code",[s._v("slowlog-log-slower-than")]),s._v("设置为20000微秒，"),t("code",[s._v("slowlog-max-len")]),s._v("设置为1000。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" slowlog-log-slower-than "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" slowlog-max-len "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nconfig rewrite\n")])])]),t("p",[t("strong",[s._v("如果要Redis将配置持久化到本地配置文件，需要执行config rewrite命令")]),s._v("。")]),s._v(" "),t("p",[s._v("虽然慢查询日志是存放在Redis内存列表中的，但是Redis并没有暴露这个列表的键，而是通过一组命令来实现对慢查询日志的访问和管理。下面介绍这几个命令。")]),s._v(" "),t("h3",{attrs:{id:"获取慢查询日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取慢查询日志"}},[s._v("#")]),s._v(" 获取慢查询日志")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("slowlog get "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("下面操作返回当前Redis的慢查询，参数n可以指定条数。每个慢查询日志有4个属性组成，分别是慢查询日志的标识id、发生时间戳、命令耗时、执行命令和参数。")]),s._v(" "),t("h3",{attrs:{id:"获取慢查询日志列表当前的长度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取慢查询日志列表当前的长度"}},[s._v("#")]),s._v(" 获取慢查询日志列表当前的长度")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("slowlog len\n")])])]),t("h3",{attrs:{id:"慢查询日志重置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志重置"}},[s._v("#")]),s._v(" 慢查询日志重置")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("slowlog reset\n")])])]),t("p",[s._v("这个命令实际上是对列表进行清理工作，清理过后，若执行"),t("code",[s._v("slowlog len")]),s._v("命令，日志长度为零。")]),s._v(" "),t("h3",{attrs:{id:"慢查询最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢查询最佳实践"}},[s._v("#")]),s._v(" 慢查询最佳实践")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("slowlog-max-len")]),s._v("配置建议：线上建议调大慢查询列表，记录慢查询时Redis会对长命令做截断操作，并不会占用大量内存。增大慢查询列表可以减缓慢查询被剔除的可能，线上可设置为1000以上。")]),s._v(" "),t("li",[t("code",[s._v("slowlog-log-slower-than")]),s._v("配置建议：默认值超过10毫秒判定为慢查询，需要根据Redis并发量调整该值。由于Redis采用单线程响应命令，对于高流量的场景，如果命令执行时间在1毫秒以上，那么Redis最多可支撑OPS不到1000。因此对于高OPS场景的Redis建议设置为1毫秒。")])]),s._v(" "),t("p",[s._v("慢查询只记录命令执行时间，并不包括命令排队和网络传输时间。因此客户端执行命令的时间会大于命令实际执行时间。因为命令执行排队机制，慢查询会导致其他命令级联阻塞，因此"),t("strong",[s._v("当客户端出现请求超时，需要检查该时间点是否有对应的慢查询，从而分析出是否为慢查询导致的命令级联阻塞。")])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),t("p",[s._v("由于慢查询日志是一个先进先出的队列，也就是说如果慢查询比较多的情况下，可能会丢失部分慢查询命令，为了防止这种情况发生，可以定期执行"),t("code",[s._v("slow get")]),s._v("命令将慢查询日志持久化到其他存储中（例如MySQL），然后可以制作可视化界面进行查询。")])]),s._v(" "),t("p",[s._v("Redis提供了redis-cli、redis-server、redis-benchmark等Shell工具。我们可以通过这些工具巧妙地解决问题。")]),s._v(" "),t("h2",{attrs:{id:"redis官方提供的shell工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis官方提供的shell工具"}},[s._v("#")]),s._v(" Redis官方提供的Shell工具")]),s._v(" "),t("p",[s._v("redis-cli除了"),t("code",[s._v("-h")]),s._v("、"),t("code",[s._v("-p")]),s._v("参数，还有其它很多有用的参数。，下面将对一些重要参数的含义以及使用场景进行说明。")]),s._v(" "),t("h3",{attrs:{id:"shell工具之redis-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell工具之redis-cli"}},[s._v("#")]),s._v(" Shell工具之redis-cli")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-r")]),s._v("参数重复执行命令")])]),s._v(" "),t("p",[s._v("-r（repeat）选项代表将命令执行多次，例如下面操作将会执行三次ping命令。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n")])])]),t("p",[s._v("通过这个命令，将打印三次"),t("code",[s._v("PONG")]),s._v("。")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[s._v("-i")]),s._v("参数定时执行一次命令")])]),s._v(" "),t("p",[s._v("-i（interval）选项代表每隔几秒执行一次命令，但是-i选项必须和-r选项一起使用，下面的操作会每隔1秒执行一次ping命令，一共执行5次。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[t("code",[s._v("--stat")]),s._v("参数实时获取Redis的重要统计信息")])]),s._v(" "),t("p",[t("code",[s._v("--stat")]),s._v("选项可以实时获取Redis的重要统计信息，虽然info命令中的统计信息更全，但是能实时看到一些增量的数据（例如requests）对于Redis的运维还是有一定帮助的。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--stat")]),s._v("\n")])])]),t("p",[s._v("执行命令，输出如下结果。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("------- data ------ --------------------- load -------------------- - child -\nkeys       mem      clients blocked requests            connections          \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n------- data ------ --------------------- load -------------------- - child -\nkeys       mem      clients blocked requests            connections          \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("834")]),s._v(".12K  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           \n------- data ------ --------------------- load ------------\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("--raw"),t("code",[s._v("和")]),s._v("--no-raw`命令返回结果是否格式化")])]),s._v(" "),t("p",[t("code",[s._v("--no-raw")]),s._v("选项是要求命令的返回结果必须是原始的格式，"),t("code",[s._v("--raw")]),s._v("恰恰相反，返回格式化后的结果。")]),s._v(" "),t("p",[s._v("例如，我们设置一个中文的value。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" hello "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"你好"')]),s._v("\n")])])]),t("p",[s._v("如果正常执行"),t("code",[s._v("get")]),s._v("或者使用"),t("code",[s._v("--no-raw")]),s._v("选项，那么返回的结果是二进制格式。")]),s._v(" "),t("p",[s._v("redis执行get命令，返回二进制结果"),t("code",[s._v("\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli get hello\n")])])]),t("p",[s._v("redis执行命令时使用"),t("code",[s._v("--no-raw")]),s._v("选项，同样返回二进制结果"),t("code",[s._v("\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli --no-raw get hello\n")])])]),t("p",[s._v("如果在执行命令时使用"),t("code",[s._v("--raw")]),s._v("选项，将会返回中文。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--raw")]),s._v(" get hello\n")])])]),t("h3",{attrs:{id:"shell工具之redis-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell工具之redis-server"}},[s._v("#")]),s._v(" Shell工具之redis-server")]),s._v(" "),t("p",[s._v("redis-server除了启动Redis外，还有一个"),t("code",[s._v("--test-memory")]),s._v("选项。 "),t("strong",[s._v("通过"),t("code",[s._v("redis-server --test-memory")]),s._v("命令，我们可以用来检测当前操作系统能否稳定地分配指定容量的内存给Redis，通过这种检测可以有效避免因为内存问题造成Redis崩溃。")])]),s._v(" "),t("p",[s._v("例如下面操作检测当前操作系统能否提供1G的内存给Redis。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-server --test-memory "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n")])])]),t("p",[s._v("整个内存检测的时间比较长。当输出passed this test时说明内存检测完毕，最后会提示--test-memory只是简单检测，如果有质疑可以使用更加专业的内存检测工具。")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),t("p",[s._v("通常无需每次开启Redis实例时都执行--test-memory选项，该功能更偏向于调试和测试。")])]),s._v(" "),t("h3",{attrs:{id:"shell工具之redis-benchmark"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell工具之redis-benchmark"}},[s._v("#")]),s._v(" Shell工具之redis-benchmark")]),s._v(" "),t("p",[s._v("redis-benchmark可以为Redis做基准性能测试，它提供了很多选项帮助开发和运维人员测试Redis的相关性能。")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("-c")]),s._v("参数代表客户端的并发数量（默认是50）")])]),s._v(" "),t("p",[t("code",[s._v("-c")]),s._v("（clients）选项代表客户端的并发数量（默认是50）。")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[s._v("-n")]),s._v("参数代表客户端请求总量（默认是100000）")])]),s._v(" "),t("p",[s._v("例如：若我们执行命令"),t("code",[s._v("redis-benchmark -c 100 -n 20000")]),s._v("代表100各个客户端同时请求Redis，一共执行20000次。redis-benchmark会对各类数据结构的命令进行测试，并给出性能指标。")]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[t("code",[s._v("-t")]),s._v("参数对指定命令进行基准测试。")])]),s._v(" "),t("p",[t("code",[s._v("-t")]),s._v("参数可以对指定命令进行基准测试。当我们执行命令"),t("code",[s._v("redis-benchmark -t get,set -q")]),s._v("。终端将输出")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SET: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57937.43")]),s._v(" requests per second\nGET: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59952.04")]),s._v(" requests per second\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[t("code",[s._v("--csv")]),s._v("参数将结果按照csv格式输出")])]),s._v(" "),t("p",[t("code",[s._v("--csv")]),s._v("选项会将结果按照csv格式输出，便于后续处理，如导出到Excel等。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-benchmark "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" get,set "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--csv")]),s._v("\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[t("code",[s._v("-k")]),s._v("代表客户端是否使用keepalive")])]),s._v(" "),t("p",[s._v("-k选项代表客户端是否使用keepalive，1为使用，0为不使用，默认值为1。")]),s._v(" "),t("h2",{attrs:{id:"redis的pipeline机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis的pipeline机制"}},[s._v("#")]),s._v(" Redis的Pipeline机制")]),s._v(" "),t("p",[s._v("Redis提供了批量操作命令（例如mget、mset等），有效地节约RTT。但大部分命令是不支持批量操作的，而且")]),s._v(" "),t("p",[s._v("Redis的客户端和服务端可能部署在不同的机器上，由于网络延迟等因素，Redis执行命令的效率将大大下降。")]),s._v(" "),t("h3",{attrs:{id:"redis使用pipeline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis使用pipeline"}},[s._v("#")]),s._v(" Redis使用Pipeline")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Pipeline（流水线）机制能改善上面这类问题，它能将一组Redis命令进行组装，通过一次RTT传输给Redis，再将这组Redis命令的执行结果按顺序返回给客户端。")])]),s._v(" "),t("p",[s._v("redis-cli的"),t("code",[s._v("--pipe")]),s._v("参数实际上就是使用Pipeline机制。但大部分开发人员更倾向于使用高级语言客户端中的Pipeline，目前大部分Redis客户端都支持Pipeline。")]),s._v(" "),t("h3",{attrs:{id:"原生批量命令与pipeline对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原生批量命令与pipeline对比"}},[s._v("#")]),s._v(" 原生批量命令与Pipeline对比")]),s._v(" "),t("ul",[t("li",[s._v("原生批量命令是原子的，Pipeline是非原子的。")]),s._v(" "),t("li",[s._v("·原生批量命令是一个命令对应多个key，Pipeline支持多个命令。")]),s._v(" "),t("li",[s._v("·原生批量命令是Redis服务端支持实现的，而Pipeline需要服务端和客户端的共同实现。")])]),s._v(" "),t("h3",{attrs:{id:"pipeline最佳实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pipeline最佳实践"}},[s._v("#")]),s._v(" Pipeline最佳实践")]),s._v(" "),t("p",[s._v("Pipeline虽然好用，但是每次Pipeline组装的命令个数不能没有节制，否则一次组装Pipeline数据量过大，一方面会增加客户端的等待时间，另一方面会造成一定的网络阻塞，可以将一次包含大量命令的Pipeline拆分成多次\n较小的Pipeline来完成。")]),s._v(" "),t("h2",{attrs:{id:"redis事务功能概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis事务功能概述"}},[s._v("#")]),s._v(" Redis事务功能概述")]),s._v(" "),t("p",[s._v("Redis提供了简单的事务功能，将一组需要一起执行的命令放到"),t("code",[s._v("multi")]),s._v("和"),t("code",[s._v("exec")]),s._v("两个命令之间。"),t("code",[s._v("multi")]),s._v("命令代表事务开始，"),t("code",[s._v("exec")]),s._v("命令代表事务结束，它们之间的命令是原子顺序执行的。如果要停止事务的执行，可以使用"),t("code",[s._v("discard")]),s._v("命令代替"),t("code",[s._v("exec")]),s._v("命令即可。")]),s._v(" "),t("h3",{attrs:{id:"redis事务基本用法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis事务基本用法"}},[s._v("#")]),s._v(" Redis事务基本用法")]),s._v(" "),t("p",[s._v("下面进行集合添加元素操作：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sadd user:a:follow user:b\nQUEUED\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sadd user:b:fans user:a\nQUEUED\n")])])]),t("p",[s._v("可以看到sadd命令此时的返回结果是QUEUED，代表命令并没有真正执行，而是暂时保存在Redis中。如果此时另一个客户端执行"),t("code",[s._v("sismember user:a:follow user:b")]),s._v("返回结果应该为0。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sismember user:a:follow user:b\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("p",[s._v("只有当"),t("code",[s._v("exec")]),s._v("执行完成后，事务操作才算完成。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("此时再次执行"),t("code",[s._v("sismember user:a:follow user:b")]),s._v("命令，命令才不会返回0。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sismember user:a:follow user:b\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("如果要停止事务的执行，可以使用"),t("code",[s._v("discard")]),s._v("命令代替exec命令即可。")]),s._v(" "),t("h3",{attrs:{id:"redis事务错误处理机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis事务错误处理机制"}},[s._v("#")]),s._v(" Redis事务错误处理机制")]),s._v(" "),t("p",[s._v("若Redis事务发生错误，Redis事务对于不同错误处理的方式不一样。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("命令错误")]),s._v("：若错误属于命令错误，则整个事务将无法执行。")]),s._v(" "),t("li",[t("strong",[s._v("运行时错误")]),s._v("：若错误属于运行时错误，例如语法正确，但本因使用集合的，使用了有序集合，则事务将继续执行。")])]),s._v(" "),t("p",[t("strong",[s._v("可以看到Redis并不支持回滚功能，若错误属于运行时错误，则需要开发人员自己解决。")])]),s._v(" "),t("p",[s._v("有些应用场景需要在事务之前，确保事务中的key没有被其他客户端修改过，才执行事务，否则不执行（类似乐观锁）。Redis提供了watch命令来解决这类问题。")]),s._v(" "),t("p",[s._v("Redis提供的事务比较简单，之所以说它简单，主要是因为它不支持事务中的回滚特性，同时无法实现命令之间的逻辑关系计算。")]),s._v(" "),t("h2",{attrs:{id:"redis中的bitmaps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis中的bitmaps"}},[s._v("#")]),s._v(" Redis中的Bitmaps")]),s._v(" "),t("p",[s._v("现代计算机用二进制（位）作为信息的基础单位，1个字节等于8位，例如“big”字符串是由3个字节组成，但实际在计算机存储时将其用二进制表示，“big”分别对应的ASCII码分别是98、105、103，对应的二进制分别是\n01100010、01101001和01100111。")]),s._v(" "),t("p",[s._v("许多开发语言都提供了操作位的功能，合理地使用位能够有效地提高内存使用率和开发效率。Redis提供了Bitmaps这个“数据结构”可以实现对位的操作。对于Bitmaps，我们需要注意两点：")]),s._v(" "),t("ul",[t("li",[s._v("Bitmaps本身不是一种数据结构，实际上它就是字符串，但是它可以对字符串的位进行操作。")]),s._v(" "),t("li",[s._v("Bitmaps单独提供了一套命令，所以在Redis中使用Bitmaps和使用字符串的方法不太相同。可以把Bitmaps想象成一个以位为单位的数组， "),t("strong",[s._v("数组的每个单元只能存储0和1，数组的下标在Bitmaps中叫做偏移量")]),s._v(" 。")])]),s._v(" "),t("h3",{attrs:{id:"bitmaps设置值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitmaps设置值"}},[s._v("#")]),s._v(" Bitmaps设置值")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("setbit key offset value\n")])])]),t("h3",{attrs:{id:"bitmaps获取值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitmaps获取值"}},[s._v("#")]),s._v(" Bitmaps获取值")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("gitbit key offset\n")])])]),t("h3",{attrs:{id:"获取bitmaps指定范围值为1的个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取bitmaps指定范围值为1的个数"}},[s._v("#")]),s._v(" 获取Bitmaps指定范围值为1的个数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bitcount "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("其中，[start]和[end]代表的是起始和结束的字节数。")]),s._v(" "),t("h3",{attrs:{id:"bitmaps间的运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bitmaps间的运算"}},[s._v("#")]),s._v(" Bitmaps间的运算")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bitop "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("op")]),s._v(" destkey key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("bitop是一个复合操作，它可以做多个Bitmaps的and（交集）、or（并集）、not（非）、xor（异或）操作并将结果保存在destkey中。")]),s._v(" "),t("h3",{attrs:{id:"计算bitmaps中第一个值为targetbit的偏移量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计算bitmaps中第一个值为targetbit的偏移量"}},[s._v("#")]),s._v(" 计算Bitmaps中第一个值为targetBit的偏移量")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bitpos key targetBit "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("end"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("除此之外，bitops有两个选项[start]和[end]，分别代表起始字节和结束字节。")]),s._v(" "),t("h2",{attrs:{id:"redis中的hyperloglog"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis中的hyperloglog"}},[s._v("#")]),s._v(" Redis中的HyperLogLog")]),s._v(" "),t("p",[s._v("HyperLogLog并不是一种新的数据结构（实际类型为字符串类型），而是一种基数算法，通过HyperLogLog可以利用极小的内存空间完成独立总数的统计，数据集可以是IP、Email、ID等。HyperLogLog提供了3个命令：\n"),t("code",[s._v("pfadd")]),s._v("、"),t("code",[s._v("pfcount")]),s._v("、"),t("code",[s._v("pfmerge")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"添加指定元素到-hyperloglog-中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加指定元素到-hyperloglog-中"}},[s._v("#")]),s._v(" 添加指定元素到 HyperLogLog 中")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pfadd key element "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("element …"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("pfadd用于向HyperLogLog添加元素，如果添加成功返回1。")]),s._v(" "),t("h3",{attrs:{id:"计算独立用户数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#计算独立用户数"}},[s._v("#")]),s._v(" 计算独立用户数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pfcount key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key …"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("pfcount用于计算一个或多个HyperLogLog的独立总数。")]),s._v(" "),t("h3",{attrs:{id:"合并hyperloglog元素"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#合并hyperloglog元素"}},[s._v("#")]),s._v(" 合并HyperLogLog元素")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pfmerge destkey sourcekey "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sourcekey "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("pfmerge可以求出多个HyperLogLog的并集并赋值给destkey。")]),s._v(" "),t("p",[s._v("HyperLogLog内存占用量非常小，但是存在错误率，开发者在进行数据结构选型时只需要确认如下两条：")]),s._v(" "),t("ul",[t("li",[s._v("只为了计算独立总数，不需要获取单条数据。")]),s._v(" "),t("li",[s._v("可以容忍一定误差率，毕竟HyperLogLog在内存的占用量上有很大的优势。")])]),s._v(" "),t("h2",{attrs:{id:"redis发布-订阅模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis发布-订阅模式"}},[s._v("#")]),s._v(" Redis发布-订阅模式")]),s._v(" "),t("p",[s._v("Redis提供了基于“发布/订阅”模式的消息机制，"),t("strong",[s._v("此种模式下，消息发布者和订阅者不进行直接通信，发布者客户端向指定的频道（channel）发布消息，订阅该频道的每个客户端都可以收到该消息。")]),s._v(" Redis提供了若干命令支持该功能，在实际应用开发时，能够为此类问题提供实现方法。")]),s._v(" "),t("p",[s._v("Redis主要提供了发布消息、订阅频道、取消订阅以及按照模式订阅和取消订阅等命令。")]),s._v(" "),t("h3",{attrs:{id:"发布消息命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布消息命令"}},[s._v("#")]),s._v(" 发布消息命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("publish channel message\n")])])]),t("p",[s._v("下面操作会向channel：sports频道发布一条消息“Tim won the championship”， "),t("strong",[s._v("返回结果为订阅者个数")]),s._v(" ，因为此时没有订阅，所以返回结果为0。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" publish channel:sports "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tim won the championship"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("h3",{attrs:{id:"订阅消息命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅消息命令"}},[s._v("#")]),s._v(" 订阅消息命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("subscribe channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("订阅者可以订阅一个或多个频道，下面操作为当前客户端订阅了"),t("code",[s._v("channel:sports")]),s._v("频道。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("subscribe channel:sports\nReading messages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("press Ctrl-C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subscribe"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("此时另一个客户端发布一条消息：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("publish channel:sports "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"James lost the championship"')]),s._v("\n")])])]),t("p",[s._v("当前订阅者客户端会收到如下消息：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("subscribe channel:sports\nReading messages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("press Ctrl-C to quit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subscribe"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"James lost the championship"')]),s._v("\n")])])]),t("p",[s._v("有关订阅命令有两点需要注意：")]),s._v(" "),t("ul",[t("li",[s._v("客户端在执行订阅命令之后进入了订阅状态，只能接收"),t("code",[s._v("subscribe")]),s._v("、"),t("code",[s._v("psubscribe")]),s._v("、"),t("code",[s._v("unsubscribe")]),s._v("、"),t("code",[s._v("punsubscribe")]),s._v("的四个命令。")]),s._v(" "),t("li",[t("strong",[s._v("新开启的订阅客户端，无法收到该频道之前的消息")]),s._v(" ，因为Redis不会对发布的消息进行持久化。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("和很多专业的消息队列系统（例如Kafka、RocketMQ）相比，Redis的发布订阅略显粗糙。")])]),s._v(" "),t("h3",{attrs:{id:"取消订阅命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取消订阅命令"}},[s._v("#")]),s._v(" 取消订阅命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("unsubscribe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("客户端可以通过unsubscribe命令取消对指定频道的订阅，取消成功后，不会再收到该频道的发布消息。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" unsubscribe channel:sports\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unsubscribe"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("h3",{attrs:{id:"按照模式订阅和取消订阅"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#按照模式订阅和取消订阅"}},[s._v("#")]),s._v(" 按照模式订阅和取消订阅")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("psubscribe pattern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npunsubscribe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("除了"),t("code",[s._v("subcribe")]),s._v("和"),t("code",[s._v("unsubscribe")]),s._v("命令，Redis命令还支持glob风格的订阅命令"),t("code",[s._v("psubscribe")]),s._v("和取消订阅命令"),t("code",[s._v("punsubscribe")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"查询订阅命令-查看活跃的频道"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询订阅命令-查看活跃的频道"}},[s._v("#")]),s._v(" 查询订阅命令-查看活跃的频道")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pubsub channels "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("所谓活跃的频道是指当前频道至少有一个订阅者，其中[pattern]是可以指定具体的模式：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pubsub channels\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n")])])]),t("h3",{attrs:{id:"查看订阅命令-查看频道订阅数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看订阅命令-查看频道订阅数"}},[s._v("#")]),s._v(" 查看订阅命令-查看频道订阅数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pubsub numsub "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("现在，我们来查看"),t("code",[s._v("channel:sports")]),s._v("频道的订阅数。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pubsub numsub channel:sports\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel:sports"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("h3",{attrs:{id:"查看订阅命令-查看模式订阅数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看订阅命令-查看模式订阅数"}},[s._v("#")]),s._v(" 查看订阅命令-查看模式订阅数")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pubsub numpat\n")])])]),t("p",[s._v("由于我们没有"),t("code",[s._v("psubscribe")]),s._v("命令，所以我们没有安装模式订阅的频道。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pubsub numpat\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),t("h2",{attrs:{id:"redis地理信息定位-geo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis地理信息定位-geo"}},[s._v("#")]),s._v(" Redis地理信息定位-GEO")]),s._v(" "),t("p",[s._v("Redis3.2版本提供了GEO（地理信息定位）功能，支持存储地理位置信 息用来实现诸如附近位置、摇一摇这类依赖于地理位置信息的功能。")]),s._v(" "),t("h3",{attrs:{id:"增加地理位置信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加地理位置信息"}},[s._v("#")]),s._v(" 增加地理位置信息")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("geoadd key longitude latitude member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("longitude latitude member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("longitude、latitude、member分别是该地理位置的经度、纬度、成员。下表展示了5个城市的经纬度。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("城市")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("经度")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("纬度")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("成员")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("北京")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("116.28")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("39.55")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("beijing")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("天津")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("117.12")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("39.08")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("tianjin")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("石家庄")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("114.29")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("38.02")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("shijiazhuang")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("唐山")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("118.01")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("39.38")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("tangshan")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("保定")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("115.29")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("38.51")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("baoding")])])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd cities:locations  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("116.28")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.55")]),s._v(" beijing\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("返回结果代表添加成功的个数，如果cities：locations没有包含beijing，那么返回结果为1，如果已经存在则返回0。")]),s._v(" "),t("h3",{attrs:{id:"更新地理位置信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新地理位置信息"}},[s._v("#")]),s._v(" 更新地理位置信息")]),s._v(" "),t("p",[s._v("如果需要更新地理位置信息，仍然可以使用"),t("code",[s._v("geoadd")]),s._v("命令，虽然返回结果为0。"),t("code",[s._v("geoadd")]),s._v("命令可以同时添加多个地理位置信息。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd cities:locations "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("117.12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.08")]),s._v(" tianjin "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.02")]),s._v(" shijiazhuang "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("118.01")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.38")]),s._v(" tangshan "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("115.29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.51")]),s._v(" baoding\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])])]),t("h3",{attrs:{id:"获取地理位置信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取地理位置信息"}},[s._v("#")]),s._v(" 获取地理位置信息")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("geopos key member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("下面操作会获取天津的经维度：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geopos cities:locations tianjin\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"117.12000042200088501"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"39.0800000535766543"')]),s._v("\n")])])]),t("h3",{attrs:{id:"获取两个地理位置的距离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取两个地理位置的距离"}},[s._v("#")]),s._v(" 获取两个地理位置的距离")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("geodist key member1 member2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("其中unit代表返回结果的单位，包含以下四种：")]),s._v(" "),t("ul",[t("li",[s._v("m（meters）代表米。")]),s._v(" "),t("li",[s._v("km（kilometers）代表公里。")]),s._v(" "),t("li",[s._v("mi（miles）代表英里。")]),s._v(" "),t("li",[s._v("ft（feet）代表尺。")])]),s._v(" "),t("p",[s._v("下面命令可以计算天津到北京的距离，并以公里为单位：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geodist cities:locations tianjin beijing km\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"89.2061"')]),s._v("\n")])])]),t("h3",{attrs:{id:"获取指定位置范围内的地理信息位置集合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取指定位置范围内的地理信息位置集合"}},[s._v("#")]),s._v(" 获取指定位置范围内的地理信息位置集合")]),s._v(" "),t("p",[s._v("获取指定位置范围内的地理信息位置集合的命令总共有两个："),t("code",[s._v("georadius")]),s._v("和"),t("code",[s._v("georadiusbymember")]),s._v("命令。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("georadius")]),s._v("命令")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("georadius key longitude latitude radius m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("km"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ft"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withcoord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withdist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withhash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COUNT count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("asc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("desc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("store key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("storedist key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[t("code",[s._v("georadiusbymember")]),s._v("命令")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("georadiusbymember key member radiusm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("km"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ft"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withcoord"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withdist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("withhash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COUNT count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("asc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("desc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("store key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("storedist key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[t("code",[s._v("georadius")]),s._v("和"),t("code",[s._v("georadiusbymember")]),s._v("两个命令的作用是一样的，都是以一个地 理位置为中心算出指定半径内的其他地理信息位置，")]),s._v(" "),t("p",[s._v("不同的是"),t("code",[s._v("georadius")]),s._v("命令的中心位置给出了具体的经纬度，"),t("code",[s._v("georadiusbymember")]),s._v("只需给出成员即可。其中"),t("code",[s._v("radiusm|km|ft|mi")]),s._v("是必需参数，指定了半径（带单位）。")]),s._v(" "),t("p",[s._v("这两个命令有很多可选参数：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("withcoord：返回结果中包含经纬度。")])]),s._v(" "),t("li",[t("p",[s._v("withdist：返回结果中包含离中心节点位置的距离。")])]),s._v(" "),t("li",[t("p",[s._v("withhash：返回结果中包含geohash，有关geohash后面介绍。")])]),s._v(" "),t("li",[t("p",[s._v("COUNT count：指定返回结果的数量。")])]),s._v(" "),t("li",[t("p",[s._v("asc|desc：返回结果按照离中心节点的距离做升序或者降序。")])]),s._v(" "),t("li",[t("p",[s._v("store key：将返回结果的地理位置信息保存到指定键。")])]),s._v(" "),t("li",[t("p",[s._v("storedist key：将返回结果离中心节点的距离保存到指定键。")])])]),s._v(" "),t("p",[s._v("下面操作计算五座城市中，距离北京150公里以内的城市。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" georadiusbymember cities:locations beijing "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v(" km\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"beijing"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianjin"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tangshan"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"baoding"')]),s._v("\n")])])]),t("h3",{attrs:{id:"获取地理位置的hash值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取地理位置的hash值"}},[s._v("#")]),s._v(" 获取地理位置的hash值")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("geohash key member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("Redis使用"),t("code",[s._v("geohash")]),s._v("将二维经纬度转换为一维字符串，下面操作会返回beijing的geohash值。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geohash cities:locations beijing\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wx48ypbe2q0"')]),s._v("\n")])])]),t("p",[s._v("geohash有如下特点：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("·GEO的数据类型为zset，Redis将所有地理位置信息的geohash存放在zset 中。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" cities:locations\nzset\n")])])])]),s._v(" "),t("li",[t("p",[s._v("字符串越长，表示的位置更精确。")])]),s._v(" "),t("li",[t("p",[s._v("·两个字符串越相似，它们之间的距离越近，Redis利用字符串前缀匹配 算法实现相关的命令。")])]),s._v(" "),t("li",[t("p",[s._v("geohash编码和经纬度是可以相互转换的。")])])]),s._v(" "),t("h3",{attrs:{id:"删除地理位置信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除地理位置信息"}},[s._v("#")]),s._v(" 删除地理位置信息")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("zrem key member\n")])])]),t("p",[s._v("GEO没有提供删除成员的命令，但是因为GEO的底层实现是zset，所以可以借用zrem命令实现对地理位置信息的删除。")])])}),[],!1,null,null,null);t.default=n.exports}}]);