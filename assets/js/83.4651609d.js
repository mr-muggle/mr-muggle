(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{733:function(t,a,s){"use strict";s.r(a);var e=s(74),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"例子1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子1-准备工作"}},[t._v("#")]),t._v(" 例子1-准备工作")]),t._v(" "),a("p",[t._v("闲话少说，现在我们开始学习第一个反向代理实例，在这个实例中，我们需要实现这样的效果：打开浏览器，在浏览器地址栏输入地址·"),a("code",[t._v("www.123.com")]),t._v("，跳转到 liunx 系统 tomcat 主页面中。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装并启动Tomcat服务器；在Linux系统中安装并以默认端口8080启动Tomcat服务器。")])]),t._v(" "),a("li",[a("p",[t._v("开放对外访问的端口")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看已经开放的端口")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd --list-all\n")])])])]),t._v(" "),a("li",[a("p",[t._v("重新加载防火墙配置")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"例子1-访问过程分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子1-访问过程分析"}},[t._v("#")]),t._v(" 例子1-访问过程分析")]),t._v(" "),a("ol",[a("li",[t._v("首先，我们在windows客户端的hosts文件中配置服务器ip和网址"),a("code",[t._v("www.123.com")]),t._v("的映射关系。")]),t._v(" "),a("li",[t._v("其次，我们在服务器上安装nginx和tomcat。nginx默认端口80，tomcat默认端口8080")]),t._v(" "),a("li",[t._v("然后，我们配置好nginx和tomcat之间的反向代理。")]),t._v(" "),a("li",[t._v("由于访问"),a("code",[t._v("www.123.com")]),t._v("实际上访问的是"),a("code",[t._v("www.123.com:80")]),t._v("服务器网址，"),a("code",[t._v("www.123.com")]),t._v("又等同于"),a("code",[t._v("192.168.31.171")]),t._v("。因此，当用户在浏览器中输入"),a("code",[t._v("www.123.com")]),t._v("实际上是请求了"),a("code",[t._v("192.168.31.171:80")]),t._v("网址访问了nginx，nignx根据配置进行反向代理，将请求转发访问tomcat服务器首页。")])]),t._v(" "),a("h2",{attrs:{id:"例子1-具体配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子1-具体配置"}},[t._v("#")]),t._v(" 例子1-具体配置")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在Windows配置文件中配置ip和域名的对应关系")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".31.171 www.123.com\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置Nginx请求转发，打开nginx配置文件"),a("code",[t._v("vi /usr/local/nginx/conf/nginx.conf")]),t._v("进行配置。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("listen")]),t._v("设置监听80端口")]),t._v(" "),a("li",[a("code",[t._v("server_name")]),t._v("设置为服务器ip地址")]),t._v(" "),a("li",[a("code",[t._v("location")]),t._v("里设置"),a("code",[t._v("proxy_pass")]),t._v("为"),a("code",[t._v("http://127.0.0.1:8080")])])]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("       mime.types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v("  application/octet-stream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  logs/access.log  main;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keepalive_timeout  0;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\n     "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  192.168.31.171")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r;")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  logs/host.access.log  main;")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n")])])])])]),t._v(" "),a("p",[t._v("这样，我们就实现了访问"),a("code",[t._v("www.123.com")]),t._v("，变更为访问8080端口的tomcat服务器首页。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/%E6%9C%8D%E5%8A%A1%E5%99%A8/nginx/123%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.png",alt:"123反向代理.png"}})]),t._v(" "),a("h2",{attrs:{id:"例子2-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子2-准备工作"}},[t._v("#")]),t._v(" 例子2-准备工作")]),t._v(" "),a("p",[t._v("接下来，我们开始学习第二个反向代理实例，该实例实现这样的效果：使用nginx 监听9001端口，通过反向代理，根据访问的路径跳转到不同tomcat服务中。在这个实例中，我们需要部署两个Tomcat服务器，")]),t._v(" "),a("p",[t._v("当访问"),a("code",[t._v("http:// ip:9001/edu/")]),t._v("时，直接跳转到"),a("code",[t._v("127.0.0.1:8080")]),t._v("，访问"),a("code",[t._v("http:// ip:9001/vod/")]),t._v("直接跳转到"),a("code",[t._v("127.0.0.1:8081")]),t._v("。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("准备两个 Tomcat 服务器，并设置一个服务器为8080端口，另一个服务器8081端口。")])]),t._v(" "),a("li",[a("p",[t._v("在使用8080端口的Tomcat服务器的"),a("code",[t._v("webapps")]),t._v("目录中，创建"),a("code",[t._v("edu")]),t._v("目录，并在目录中创建"),a("code",[t._v("a.html")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("Tomcat 8080!!\n")])])])]),t._v(" "),a("li",[a("p",[t._v("同理，在使用8081端口的Tomcat服务器的"),a("code",[t._v("webapps")]),t._v("目录中，创建"),a("code",[t._v("vod")]),t._v("目录，并在目录中创建"),a("code",[t._v("a.html")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("Tomcat 8081!!\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"例子2-具体配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子2-具体配置"}},[t._v("#")]),t._v(" 例子2-具体配置")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("对Nginx配置文件进行配置。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" 192.168.31.171")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /edu/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /vod/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:8081")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("开放对外访问的9001、8081端口。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v("\nfirewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("访问"),a("code",[t._v("http://192.168.31.171:9001/edu/a.html")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/%E6%9C%8D%E5%8A%A1%E5%99%A8/nginx/%E8%AE%BF%E9%97%AETomcat8080.png",alt:"访问Tomcat8080"}})])]),t._v(" "),a("li",[a("p",[t._v("访问"),a("code",[t._v("http://192.168.31.171:9001/vod/a.html")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/%E6%9C%8D%E5%8A%A1%E5%99%A8/nginx/%E8%AE%BF%E9%97%AETomcat8081.png",alt:"访问Tomcat8081"}})])])]),t._v(" "),a("h2",{attrs:{id:"location指令说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location指令说明"}},[t._v("#")]),t._v(" location指令说明")]),t._v(" "),a("p",[t._v("该指令的作用是用于匹配URL，其语法如下：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" [= | ~ | ~* | ^~] uri")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("1、"),a("code",[t._v("=")]),t._v("：用于不含正则表达式的uri前，要求请求字符串和uri严格匹配，如果匹配成功，则停止向下搜索并立即停止该请求。")]),t._v(" "),a("p",[t._v("2、"),a("code",[t._v("~")]),t._v("：用于表示uri包含正则表达式，并且区分大小写。")]),t._v(" "),a("p",[t._v("3、"),a("code",[t._v("~*")]),t._v("：用于表示uri包含正则表达式，并且不区分大小写。")]),t._v(" "),a("p",[t._v("4、"),a("code",[t._v("^~")]),t._v("：用于不含正则表达式的uri前，要求Nginx服务器找到标识uri和请求字符串匹配度最高的location之后，立即使用此location处理请求，而不再使用location块中的正则uri和请求字符串做匹配。")]),t._v(" "),a("p",[a("strong",[t._v("注意：如果uri中包含正则表达式，则必须要有"),a("code",[t._v("~")]),t._v("或者"),a("code",[t._v("~*")]),t._v("标识。")])])])}),[],!1,null,null,null);a.default=n.exports}}]);