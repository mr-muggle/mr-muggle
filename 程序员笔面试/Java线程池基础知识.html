<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Java线程池基础知识 | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/41.ef41848b.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/25.0536eb3c.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/27.10fbd948.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/34.112b9f11.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/61.d314066d.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/91.0823b62f.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/程序员笔面试/Java基础知识.html" title="Java基础知识" class="sidebar-link">Java基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Java集合基础知识.html" title="Java集合基础知识" class="sidebar-link">Java集合基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Java输入输出基础知识.html" title="Java输入输出基础知识" class="sidebar-link">Java输入输出基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Java线程基础知识.html" title="Java线程基础知识" class="sidebar-link">Java线程基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html" title="Java线程池基础知识" class="active sidebar-link">Java线程池基础知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#使用线程池的好处" title="使用线程池的好处" class="sidebar-link">使用线程池的好处</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池的工作原理" title="线程池的工作原理" class="sidebar-link">线程池的工作原理</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#创建线程池的方式" title="创建线程池的方式" class="sidebar-link">创建线程池的方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#executors-创建线程池" title="Executors 创建线程池" class="sidebar-link">Executors 创建线程池</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#threadpoolexecutor创建线程池" title="ThreadPoolExecutor创建线程池" class="sidebar-link">ThreadPoolExecutor创建线程池</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池的任务队列" title="线程池的任务队列" class="sidebar-link">线程池的任务队列</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池提交任务的方式" title="线程池提交任务的方式" class="sidebar-link">线程池提交任务的方式</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池异常处理" title="线程池异常处理" class="sidebar-link">线程池异常处理</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池拒绝策略" title="线程池拒绝策略" class="sidebar-link">线程池拒绝策略</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池状态" title="线程池状态" class="sidebar-link">线程池状态</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/程序员笔面试/Java线程池基础知识.html#线程池常用方法" title="线程池常用方法" class="sidebar-link">线程池常用方法</a></li></ul></li><li><a href="/mr-muggle/程序员笔面试/Java虚拟机基础知识.html" title="Java虚拟机基础知识" class="sidebar-link">Java虚拟机基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Spring框架基础知识.html" title="Spring框架基础知识" class="sidebar-link">Spring框架基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Struts2框架基础知识.html" title="Struts2基础知识" class="sidebar-link">Struts2基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/MyBatis框架基础知识.html" title="MyBatis框架基础知识" class="sidebar-link">MyBatis框架基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/MySQL数据库基础知识.html" title="MySQL数据库基础知识" class="sidebar-link">MySQL数据库基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Redis数据库基础知识.html" title="Redis数据库基础知识" class="sidebar-link">Redis数据库基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/SpringBoot框架基础知识.html" title="Spring Boot框架基础知识" class="sidebar-link">Spring Boot框架基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/SpringCloud框架基础知识.html" title="SpringCloud框架基础知识" class="sidebar-link">SpringCloud框架基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/Dubbo框架基础知识.html" title="Dubbo框架基础知识" class="sidebar-link">Dubbo框架基础知识</a></li><li><a href="/mr-muggle/程序员笔面试/计算机网络基础知识.html" title="计算机网络基础知识" class="sidebar-link">计算机网络基础知识</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="使用线程池的好处"><a href="#使用线程池的好处" class="header-anchor">#</a> 使用线程池的好处</h2> <ul><li><p><strong>降低资源消耗</strong>。通过重复利用已创建的线程降低线程创建和销毁造成的消耗。</p></li> <li><p><strong>提高响应速度</strong>。当任务到达时，任务可以不需要等到线程创建就能立即执行。</p></li> <li><p><strong>提高线程的可管理性</strong>。线程是稀缺资源，如果无限制地创建，不仅会消耗系统资源,还会降低系统的稳定性，使用线程池可以进行统一分配、调优和监控。</p></li></ul> <h2 id="线程池的工作原理"><a href="#线程池的工作原理" class="header-anchor">#</a> 线程池的工作原理</h2> <p><img src="/%E9%9D%A2%E8%AF%95/%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt="线程池工作原理"></p> <p>当线程池中有任务需要执行时，线程池会判断如果线程数量没有超过核心数量就会新建线程池进行任务执行，如果线程池中的线程数量已经超过核心线程数，这时候任务就会被放入任务队列中排队等待执行；如果任务队列超过最大队列数，并且线程池没有达到最大线程数，就会新建线程来执行任务；如果超过了最大线程数，就会执行拒绝执行策略。</p> <h2 id="创建线程池的方式"><a href="#创建线程池的方式" class="header-anchor">#</a> 创建线程池的方式</h2> <h3 id="executors-创建线程池"><a href="#executors-创建线程池" class="header-anchor">#</a> Executors 创建线程池</h3> <p>Executors 执行器创建线程池很多基本上都是在 <code>ThreadPoolExecutor</code>构造方法上进行简单的封装，特殊场景根据需要自行创建。可以把Executors理解成一个工厂类 。</p> <table><thead><tr><th>方法</th> <th>特点</th> <th>工作机制</th> <th>使用场景</th></tr></thead> <tbody><tr><td><code>newFixedThreadPool</code></td> <td>1. 这类线程池的特点就是里面全是核心线程，没有非核心线程，也没有超时机制，<code>keepAliveTime</code>在这里是无效的，任务大小也是没有限制的，<br>2. 数量固定，即使是空闲状态，线程不会被回收，除非线程池被关闭，从构造方法也可以看出来，只有两个参数，一个是指定的核心线程数，一个是线程工厂，<br>3. 任务队列采用了无界的阻塞队列<code>LinkedBlockingQueue</code></td> <td>1.  如果线程数少于核心线程，<br>创建核心线程执行任务 <br>2.  如果线程数等于核心线程，<br>把任务添加到<code>LinkedBlockingQueue</code>阻塞队列 ，如果线程执行完任务，去阻塞队列取任务，继续执行。</td> <td>适用于任务量比较固定但耗时长的任务</td></tr> <tr><td><code>newCacheThreadPool</code></td> <td>1. 这类线程池的特点就是里面没有核心线程，全是非核心线程<code>，</code>其<code>maximumPoolSize</code>设置为<code>Integer.MAX_VALUE</code>，线程可以无限创建，当线程池中的线程都处于活动状态的时候，线程池会创建新的线程来处理新任务，否则会用空闲的线程来处理新任务，<br> 2. 这类线程池的空闲线程都是有超时机制的，<code>keepAliveTime</code>在这里是有效的，时长为60秒，超过60秒的空闲线程就会被回收，<br>3. 当线程池都处于闲置状态时，线程池中的线程都会因为超时而被回收，所以几乎不会占用什么系统资源。<br> 4. 任务队列采用的是<code>SynchronousQueue</code>，这个队列是无法插入任务的，一有任务立即执行.</td> <td>1. 因为没有核心线程，所以任务直接加到<code>SynchronousQueue</code>队列。 <br>2. 判断是否有空闲线程，如果有，就去取出任务执行。 如果没有空闲线程，就新建一个线程执行。<br>3.  执行完任务的线程，还可以存活60秒，如果在这期间，接到任务，可以继续活下去；否则，被销毁。</td> <td>用于并发执行大量短期的小任务。</td></tr> <tr><td><code>newScheduledThreadPool</code></td> <td>1. 这类线程池核心线程数量是固定的，和<code>FixThreadPool</code>有点像，但是它的非核心线程是没有限制的，并且非核心线程一闲置就会被回收。<br> 2. <code>keepAliveTime</code>同样无效，因为核心线程是不会回收的，<br>3. 任务队列采用的<code>DelayQueue</code>是个无界的队列，延时执行队列任务。</td> <td>1. 当运行的线程数没有达到<code>corePoolSize</code>的时候，就新建线程去<code>DelayQueue</code>中取<code>ScheduledFutureTask</code>，<br>然后才去执行任务，<br> 2. 否则就把任务添加<code>DelayQueue</code>，<code>DelayQueue</code>会将任务排序，新建一个非核心线程顺序执行，执行完线程就回收，然后循环。</td> <td>适用于执行定时任务和具体固定周期的重复任务</td></tr> <tr><td><code>newSingleThreadExecutor</code></td> <td>1. 只有一个核心线程的线程池，从构造方法来看，它可以单独执行，也可以与周期线程池结合用。<br>2. 其任务队列是<code>LinkedBlockingQueue</code>，这是个无界的阻塞队列，因为线程池里只有一个线程，就确保所有的任务都在同一个线程中顺序执行。</td> <td>1. 如果线程池没有一条线程，新建线程执行任务<br> 2. 如果有，将任务加到阻塞队列当前的唯一线程，从队列取任务，执行完一个，再继续执行下一个。</td> <td>适用于串行执行任务的场景，一个任务一个任务地执行。</td></tr> <tr><td><code>newSingleThreadScheduledExecutor</code></td> <td>此线程池就是单线程的<code>newScheduledThreadPool</code>。</td> <td></td> <td></td></tr> <tr><td><code>newWorkStealingPool</code></td> <td>Java 8 新增创建线程池的方法，创建时如果不设置任何参数，则以当前机器CPU 处理器数作为线程个数，此线程池会并行处理任务，不能保证执行顺序。</td> <td></td> <td></td></tr></tbody></table> <h3 id="threadpoolexecutor创建线程池"><a href="#threadpoolexecutor创建线程池" class="header-anchor">#</a> ThreadPoolExecutor创建线程池</h3> <p><code>Executors</code>中创建线程池的快捷方法，实际上是调用了<code>ThreadPoolExecutor</code>的构造方法（定时任务使用的是<code>ScheduledThreadPoolExecutor</code>），该类构造方法参数列表如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Java线程池的完整构造函数</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
  <span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span> <span class="token comment">// 线程池长期维持的线程数，即使线程处于Idle状态，也不会回收。</span>
  <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span> <span class="token comment">// 线程数的上限</span>
  <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span> <span class="token comment">// 超过corePoolSize的线程的idle时长，</span>
                                     <span class="token comment">// 超过这个时间，多余的线程会被回收。</span>
  <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span> <span class="token comment">// 任务的排队队列</span>
  <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span> <span class="token comment">// 新线程的产生方式</span>
  <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拒绝策略</span>
</code></pre></div><p>参数解释如下：</p> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td><code>corePoolSize</code></td> <td>中的核心线程数，默认情况下核心线程一直存活在线程池中，如果将<code>ThreadPoolExecutor</code> 的 <code>allowCoreThreadTimeOut</code> 属性设为 true，如果线程池一直闲置并超过了 <code>keepAliveTime</code> 所指定的时间，核心线程就会被终止。</td></tr> <tr><td><code>maximumPoolSize</code></td> <td>最大线程数，当线程不够时能够创建的最大线程数。</td></tr> <tr><td><code>keepAliveTime</code></td> <td>线程池的闲置超时时间，默认情况下对非核心线程生效，如果闲置时间超过这个时间，非核心线程就会被回收。如果 <code>ThreadPoolExecutor</code>的 <code>allowCoreThreadTimeOut</code>设为 <code>true</code> 的时候，核心线程如果超过闲置时长也会被回收。</td></tr> <tr><td><code>unit</code></td> <td>配合 <code>keepAliveTime</code> 使用，用来标识 <code>keepAliveTime</code> 的时间单位。可选的单位有天（DAYS）、小时（HOURS）、分钟（MINUTES）、毫秒（MILLISECONDS）、微秒（MICROSECONDS，千分之一毫秒）和纳秒（NANOSECONDS，千分之一微秒）。</td></tr> <tr><td><code>workQueue</code></td> <td>线程池中的任务队列，使用 <code>execute()</code>或 <code>submit()</code>方法提交的任务都会存储在此队列中。</td></tr> <tr><td><code>threadFactory</code></td> <td>为线程池提供创建新线程的线程工厂。</td></tr> <tr><td><code>rejectedExecutionHandler</code></td> <td>线程池任务队列超过最大值之后的拒绝策略，<code>RejectedExecutionHandler</code> 是一个接口，里面只有一个 <code>rejectedExecution</code> 方法，可在此方法内添加任务超出最大值的事件处理。</td></tr></tbody></table> <h2 id="线程池的任务队列"><a href="#线程池的任务队列" class="header-anchor">#</a> 线程池的任务队列</h2> <p>任务队列，用于保持或等待执行的任务阻塞队列。<code>BlockingQueue</code>的实现类即可，有无界队列和有界队列</p> <table><thead><tr><th>队列</th> <th>说明</th></tr></thead> <tbody><tr><td><code>ArrayBlockingQueue</code></td> <td>基于数组结构的有界队列，此队列按FIFO原则对元素进行排序</td></tr> <tr><td><code>LinkedBlockingQueue</code></td> <td><code>LinkedBlockingQueue</code>（可设置容量队列）基于链表结构的阻塞队列，按FIFO排序任务，容量可以选择进行设置，不设置的话，将是一个无边界的阻塞队列，最大长度为<code>Integer.MAX_VALUE</code>，吞吐量通常要高于<code>ArrayBlockingQuene</code>；<code>newFixedThreadPool</code>线程池使用了这个队列。</td></tr> <tr><td><code>DelayQueue</code></td> <td><code>DelayQueue</code>（延迟队列）是一个任务定时周期的延迟执行的队列。根据指定的执行时间从小到大排序，否则根据插入到队列的先后排序。<code>newScheduledThreadPool</code>线程池使用了这个队列。</td></tr> <tr><td><code>SynchronousQueue</code></td> <td><code>SynchronousQueue</code>（同步队列）一个不存储元素的阻塞队列，每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态，吞吐量通常要高于<code>LinkedBlockingQuene</code>，<code>newCachedThreadPool</code>线程池使用了这个队列。</td></tr> <tr><td><code>PriorityBlockingQueue</code></td> <td><code>PriorityBlockingQueue</code>（优先级队列）是具有优先级的无界阻塞队列；</td></tr></tbody></table> <h2 id="线程池提交任务的方式"><a href="#线程池提交任务的方式" class="header-anchor">#</a> 线程池提交任务的方式</h2> <p>线程池框架提供了两种方式提交任务，<code>submit()</code>和<code>execute()</code>，通过<code>submit()</code>方法提交的任务可以返回任务执行的结果，通过<code>execute()</code>方法提交的任务不能获取任务执行的结果。</p> <table><thead><tr><th>提交方式</th> <th>是否关心结果</th></tr></thead> <tbody><tr><td><code>Future&lt;T&gt; submit(Callable&lt;T&gt; task)</code></td> <td>是</td></tr> <tr><td><code>void execute(Runnable command)</code></td> <td>否</td></tr> <tr><td><code>Future&lt;?&gt; submit(Runnable task)</code></td> <td>否，但是其<code>get()</code>总是返回null</td></tr></tbody></table> <h2 id="线程池异常处理"><a href="#线程池异常处理" class="header-anchor">#</a> 线程池异常处理</h2> <p>在使用线程池处理任务的时候，任务代码可能抛出<code>RuntimeException</code>，抛出异常后，线程池可能捕获它，也可能创建一个新的线程来代替异常的线程，我们可能无法感知任务出现了异常，因此我们需要考虑线程池异常情况。可以考虑使用以下方式：</p> <ol><li><p>在任务代码<code>try/catch</code>捕获异常。</p></li> <li><p><code>submit</code>执行，通过<code>Future</code>对象的get方法接收抛出的异常，再处理。</p></li> <li><p>实例化时，传入自己的 <code>ThreadFactory</code>，为工作者线程设置<code>UncaughtExceptionHandler</code>，在<code>uncaughtException</code>方法中处理异常。</p></li> <li><p>重写<code>ThreadPoolExecutor</code>的<code>afterExecute</code>方法，处理传递的异常引用。</p></li></ol> <h2 id="线程池拒绝策略"><a href="#线程池拒绝策略" class="header-anchor">#</a> 线程池拒绝策略</h2> <p><code>ThreadPoolExecutor</code> 也提供了 4 种默认的拒绝策略：</p> <table><thead><tr><th>拒绝策略</th> <th>说明</th></tr></thead> <tbody><tr><td><code>DiscardPolicy()</code></td> <td>丢弃掉该任务，不进行处理。</td></tr> <tr><td><code>DiscardOldestPolicy()</code></td> <td>丢弃队列里最近的一个任务，并执行当前任务。</td></tr> <tr><td><code>AbortPolicy()</code></td> <td>直接抛出 <code>RejectedExecutionException</code> 异常(<strong>默认</strong>)。</td></tr> <tr><td><code>CallerRunsPolicy()</code></td> <td>既不抛弃任务也不抛出异常，直接使用主线程来执行此任务。</td></tr></tbody></table> <h2 id="线程池状态"><a href="#线程池状态" class="header-anchor">#</a> 线程池状态</h2> <p>线程池有这几个状态：<code>RUNNING</code>，<code>SHUTDOWN</code>，<code>STOP</code>，<code>TIDYING</code>，<code>TERMINATED</code>。</p> <table><thead><tr><th>状态</th> <th>特点</th></tr></thead> <tbody><tr><td><strong>RUNNING</strong></td> <td>该状态的线程池会接收新任务，并处理阻塞队列中的任务; <br>调用线程池的<code>shutdown()</code>方法，可以切换到SHUTDOWN状态; <br>调用线程池的<code>shutdownNow()</code>方法，可以切换到STOP状态;</td></tr> <tr><td><strong>SHUTDOWN</strong></td> <td>该状态的线程池不会接收新任务，但会处理阻塞队列中的任务；<br> 队列为空，并且线程池中执行的任务也为空,进入TIDYING状态;</td></tr> <tr><td><strong>STOP</strong></td> <td>该状态的线程不会接收新任务，也不会处理阻塞队列中的任务，而且会中断正在运行的任务；<br> 线程池中执行的任务为空,进入TIDYING状态;</td></tr> <tr><td><strong>TIDYING</strong></td> <td>该状态表明所有的任务已经运行终止，记录的任务数量为0。 terminated()执行完毕，进入TERMINATED状态</td></tr> <tr><td><strong>TERMINATED</strong></td> <td>该状态表示线程池彻底终止</td></tr></tbody></table> <h2 id="线程池常用方法"><a href="#线程池常用方法" class="header-anchor">#</a> 线程池常用方法</h2> <p><code>ThreadPoolExecutor</code>有如下常用方法：</p> <ul><li><code>submit()/execute()</code>：执行线程池</li> <li><code>shutdown()/shutdownNow()</code>：终止线程池
<ul><li>使用<code>shutdown()</code>程序不会报错，也不会立即终止线程，它会等待线程池中的缓存任务执行完之后再退出，执行了 <code>shutdown()</code>之后就不能给线程池添加新任务了；</li> <li><code>shutdownNow()</code> 会试图立马停止任务，如果线程池中还有缓存任务正在执行，则会抛出<code>java.lang.InterruptedException: sleep interrupted</code> 异常。</li></ul></li> <li><code>isShutdown()</code>：判断线程是否终止</li> <li><code>getActiveCount()</code>：正在运行的线程数</li> <li><code>getCorePoolSize()</code>：获取核心线程数</li> <li><code>getMaximumPoolSize()</code>：获取最大线程数</li> <li><code>getQueue()</code>：获取线程池中的任务队列</li> <li><code>allowCoreThreadTimeOut(boolean)</code>：设置空闲时是否回收核心线程</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">3/11/2021, 7:31:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mr-muggle/程序员笔面试/Java线程基础知识.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        Java线程基础知识
      </a></span> <span class="next"><a href="/mr-muggle/程序员笔面试/Java虚拟机基础知识.html">
        Java虚拟机基础知识
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#使用线程池的好处" title="使用线程池的好处" class="ant-anchor-link-title">使用线程池的好处</a></div><div class="ant-anchor-link"><a href="#线程池的工作原理" title="线程池的工作原理" class="ant-anchor-link-title">线程池的工作原理</a></div><div class="ant-anchor-link"><a href="#创建线程池的方式" title="创建线程池的方式" class="ant-anchor-link-title">创建线程池的方式</a><div class="ant-anchor-link"><a href="#executors-创建线程池" title="Executors 创建线程池" class="ant-anchor-link-title">Executors 创建线程池</a></div><div class="ant-anchor-link"><a href="#threadpoolexecutor创建线程池" title="ThreadPoolExecutor创建线程池" class="ant-anchor-link-title">ThreadPoolExecutor创建线程池</a></div></div><div class="ant-anchor-link"><a href="#线程池的任务队列" title="线程池的任务队列" class="ant-anchor-link-title">线程池的任务队列</a></div><div class="ant-anchor-link"><a href="#线程池提交任务的方式" title="线程池提交任务的方式" class="ant-anchor-link-title">线程池提交任务的方式</a></div><div class="ant-anchor-link"><a href="#线程池异常处理" title="线程池异常处理" class="ant-anchor-link-title">线程池异常处理</a></div><div class="ant-anchor-link"><a href="#线程池拒绝策略" title="线程池拒绝策略" class="ant-anchor-link-title">线程池拒绝策略</a></div><div class="ant-anchor-link"><a href="#线程池状态" title="线程池状态" class="ant-anchor-link-title">线程池状态</a></div><div class="ant-anchor-link"><a href="#线程池常用方法" title="线程池常用方法" class="ant-anchor-link-title">线程池常用方法</a></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/41.ef41848b.js" defer></script>
  </body>
</html>