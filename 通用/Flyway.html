<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>数据库迁移工具Flyway | Knowledge</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/mr-mugglefavicon.ico">
    <meta name="description" content="talk is cheap show me the code">
    <link rel="preload" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css" as="style"><link rel="preload" href="/mr-muggle/assets/js/app.03b0f33a.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/2.c49e4524.js" as="script"><link rel="preload" href="/mr-muggle/assets/js/91.0823b62f.js" as="script"><link rel="prefetch" href="/mr-muggle/assets/js/10.b769111d.js"><link rel="prefetch" href="/mr-muggle/assets/js/11.3b528e8b.js"><link rel="prefetch" href="/mr-muggle/assets/js/12.262bc424.js"><link rel="prefetch" href="/mr-muggle/assets/js/13.701f9444.js"><link rel="prefetch" href="/mr-muggle/assets/js/14.f5836d8f.js"><link rel="prefetch" href="/mr-muggle/assets/js/15.f6ae0270.js"><link rel="prefetch" href="/mr-muggle/assets/js/16.88f016bf.js"><link rel="prefetch" href="/mr-muggle/assets/js/17.2cb6dc15.js"><link rel="prefetch" href="/mr-muggle/assets/js/18.190ccd99.js"><link rel="prefetch" href="/mr-muggle/assets/js/19.5b842041.js"><link rel="prefetch" href="/mr-muggle/assets/js/20.23e5f14f.js"><link rel="prefetch" href="/mr-muggle/assets/js/21.76eb19cf.js"><link rel="prefetch" href="/mr-muggle/assets/js/22.9a998e87.js"><link rel="prefetch" href="/mr-muggle/assets/js/23.d79bc80a.js"><link rel="prefetch" href="/mr-muggle/assets/js/24.68b1ece9.js"><link rel="prefetch" href="/mr-muggle/assets/js/25.0536eb3c.js"><link rel="prefetch" href="/mr-muggle/assets/js/26.e1e22d1b.js"><link rel="prefetch" href="/mr-muggle/assets/js/27.10fbd948.js"><link rel="prefetch" href="/mr-muggle/assets/js/28.9d8bf67a.js"><link rel="prefetch" href="/mr-muggle/assets/js/29.959e32d1.js"><link rel="prefetch" href="/mr-muggle/assets/js/3.4c2c33d8.js"><link rel="prefetch" href="/mr-muggle/assets/js/30.98fcced0.js"><link rel="prefetch" href="/mr-muggle/assets/js/31.c3717be1.js"><link rel="prefetch" href="/mr-muggle/assets/js/32.04594faa.js"><link rel="prefetch" href="/mr-muggle/assets/js/33.cbdbae4d.js"><link rel="prefetch" href="/mr-muggle/assets/js/34.112b9f11.js"><link rel="prefetch" href="/mr-muggle/assets/js/35.b52ec603.js"><link rel="prefetch" href="/mr-muggle/assets/js/36.6a59af48.js"><link rel="prefetch" href="/mr-muggle/assets/js/37.7974b0c2.js"><link rel="prefetch" href="/mr-muggle/assets/js/38.f998387a.js"><link rel="prefetch" href="/mr-muggle/assets/js/39.89abf77c.js"><link rel="prefetch" href="/mr-muggle/assets/js/4.8c3e511b.js"><link rel="prefetch" href="/mr-muggle/assets/js/40.ec4c57c4.js"><link rel="prefetch" href="/mr-muggle/assets/js/41.ef41848b.js"><link rel="prefetch" href="/mr-muggle/assets/js/42.8538a508.js"><link rel="prefetch" href="/mr-muggle/assets/js/43.c712f5fa.js"><link rel="prefetch" href="/mr-muggle/assets/js/44.7e2435a1.js"><link rel="prefetch" href="/mr-muggle/assets/js/45.633f2d43.js"><link rel="prefetch" href="/mr-muggle/assets/js/46.1bd7c05d.js"><link rel="prefetch" href="/mr-muggle/assets/js/47.e5df90ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/48.cd6c7156.js"><link rel="prefetch" href="/mr-muggle/assets/js/49.90631ebb.js"><link rel="prefetch" href="/mr-muggle/assets/js/5.6834c560.js"><link rel="prefetch" href="/mr-muggle/assets/js/50.9f214f89.js"><link rel="prefetch" href="/mr-muggle/assets/js/51.99a8dd78.js"><link rel="prefetch" href="/mr-muggle/assets/js/52.aec5051a.js"><link rel="prefetch" href="/mr-muggle/assets/js/53.7b621de8.js"><link rel="prefetch" href="/mr-muggle/assets/js/54.aa323f86.js"><link rel="prefetch" href="/mr-muggle/assets/js/55.63b233d9.js"><link rel="prefetch" href="/mr-muggle/assets/js/56.2cc8fe7b.js"><link rel="prefetch" href="/mr-muggle/assets/js/57.2a7a35c6.js"><link rel="prefetch" href="/mr-muggle/assets/js/58.3ef9ff2d.js"><link rel="prefetch" href="/mr-muggle/assets/js/59.4194402f.js"><link rel="prefetch" href="/mr-muggle/assets/js/6.ad05d8e5.js"><link rel="prefetch" href="/mr-muggle/assets/js/60.01275a59.js"><link rel="prefetch" href="/mr-muggle/assets/js/61.d314066d.js"><link rel="prefetch" href="/mr-muggle/assets/js/62.68ce6bc5.js"><link rel="prefetch" href="/mr-muggle/assets/js/63.34dea9e0.js"><link rel="prefetch" href="/mr-muggle/assets/js/64.9aaf5e00.js"><link rel="prefetch" href="/mr-muggle/assets/js/65.e4ce25ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/66.5d9f1db5.js"><link rel="prefetch" href="/mr-muggle/assets/js/67.c914fc65.js"><link rel="prefetch" href="/mr-muggle/assets/js/68.5ee52c48.js"><link rel="prefetch" href="/mr-muggle/assets/js/69.680accb1.js"><link rel="prefetch" href="/mr-muggle/assets/js/7.0c092304.js"><link rel="prefetch" href="/mr-muggle/assets/js/70.cf4408b5.js"><link rel="prefetch" href="/mr-muggle/assets/js/71.33ad3ca9.js"><link rel="prefetch" href="/mr-muggle/assets/js/72.87880929.js"><link rel="prefetch" href="/mr-muggle/assets/js/73.11b998f6.js"><link rel="prefetch" href="/mr-muggle/assets/js/74.5a75b187.js"><link rel="prefetch" href="/mr-muggle/assets/js/75.5301781a.js"><link rel="prefetch" href="/mr-muggle/assets/js/76.c446bc20.js"><link rel="prefetch" href="/mr-muggle/assets/js/77.4eaa9052.js"><link rel="prefetch" href="/mr-muggle/assets/js/78.3b98b54f.js"><link rel="prefetch" href="/mr-muggle/assets/js/79.60b9a9ba.js"><link rel="prefetch" href="/mr-muggle/assets/js/8.471386f2.js"><link rel="prefetch" href="/mr-muggle/assets/js/80.7b067e03.js"><link rel="prefetch" href="/mr-muggle/assets/js/81.8274f49e.js"><link rel="prefetch" href="/mr-muggle/assets/js/82.b72070ad.js"><link rel="prefetch" href="/mr-muggle/assets/js/83.4651609d.js"><link rel="prefetch" href="/mr-muggle/assets/js/84.fffdd780.js"><link rel="prefetch" href="/mr-muggle/assets/js/85.10865df0.js"><link rel="prefetch" href="/mr-muggle/assets/js/86.5b4b0452.js"><link rel="prefetch" href="/mr-muggle/assets/js/87.a270ec2b.js"><link rel="prefetch" href="/mr-muggle/assets/js/88.8bb08b0f.js"><link rel="prefetch" href="/mr-muggle/assets/js/89.3826a944.js"><link rel="prefetch" href="/mr-muggle/assets/js/9.d8124a2e.js"><link rel="prefetch" href="/mr-muggle/assets/js/90.dbf7dede.js"><link rel="prefetch" href="/mr-muggle/assets/js/92.8ec406ed.js">
    <link rel="stylesheet" href="/mr-muggle/assets/css/0.styles.a4a1d2b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/mr-muggle/" class="router-link-active no-logo home-link"><!----> <span class="site-name">Knowledge</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/mr-muggle/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          后端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          前端开发必知必会
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          数据库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          消息队列
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          搜索引擎
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          项目部署与运维
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          办公软件
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><!----> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/mr-muggle/通用/Flyway.html" title="数据库迁移工具Flyway" class="active sidebar-link">数据库迁移工具Flyway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#引言" title="引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#flyway支持的数据库" title="Flyway支持的数据库" class="sidebar-link">Flyway支持的数据库</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#使用flyway的好处" title="使用Flyway的好处" class="sidebar-link">使用Flyway的好处</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#flyway命令" title="Flyway命令" class="sidebar-link">Flyway命令</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#spring-boot集成flyway" title="Spring Boot集成Flyway" class="sidebar-link">Spring Boot集成Flyway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#引入flyway依赖" title="引入Flyway依赖" class="sidebar-link">引入Flyway依赖</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#添加flyway配置" title="添加Flyway配置" class="sidebar-link">添加Flyway配置</a></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#创建迁移脚本" title="创建迁移脚本" class="sidebar-link">创建迁移脚本</a></li></ul></li><li class="sidebar-sub-header"><a href="/mr-muggle/通用/Flyway.html#flyway迁移流程" title="Flyway迁移流程" class="sidebar-link">Flyway迁移流程</a></li></ul></li><li><a href="/mr-muggle/通用/DynamicDatasource.html" title="动态切换数据库dynamic-datasource" class="sidebar-link">动态切换数据库dynamic-datasource</a></li><li><a href="/mr-muggle/通用/DataDesensitization.html" title="自定义注解实现数据脱敏" class="sidebar-link">自定义注解实现数据脱敏</a></li><li><a href="/mr-muggle/通用/JasyptDataDesensitization.html" title="Jasypt实现配置脱敏" class="sidebar-link">Jasypt实现配置脱敏</a></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>在项目迭代开发中，难免会有更新数据库 Schema 的情况，比如添加新表、在表中增加字段或者删除字段等，那么当我对数据库进行一系列操作后，如何快速地在其他同事的电脑上同步？如何在测试/生产服务器上快速同步？
每次发版的时候，由于大家都可能有 sql 更改情况，这样就会有以下痛点：</p> <ul><li>忘记某些 sql 修改</li> <li>每个开发人员的 sql 的执行顺序问题</li> <li>重复更新</li> <li>需要手动去数据库执行脚本</li></ul> <p>以上问题以及痛点可以通过 Flyway 工具来解决，Flyway 可以实现自动化的数据库版本管理，并且能够记录数据库版本更新记录。</p> <h2 id="flyway支持的数据库"><a href="#flyway支持的数据库" class="header-anchor">#</a> Flyway支持的数据库</h2> <p>Flyway 是独立于数据库的应用、管理并跟踪数据库变更的数据库版本管理工具。用通俗的话讲，Flyway 可以像 Git 管理不同人的代码那样，管理不同人的 sql 脚本，从而做到数据库同步，更多的信息可以在 Flyway 的官网上进行阅读学习。</p> <p>另外 Flyway 支持很多关系数据库，具体如下所示：</p> <p><img src="/flyway/Flyway%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="Flyway支持的数据库"></p> <h2 id="使用flyway的好处"><a href="#使用flyway的好处" class="header-anchor">#</a> 使用Flyway的好处</h2> <ul><li><p>使用简单</p> <p>之前进行迁移需要考虑数据库当前状态，脚本是不是被执行过，在这个环境修复的问题，在另一个环境存在吗？现在，只需要一个命令，Flyway就为你完成比较并升级。</p></li> <li><p>很好地解决数据库版本管理和迁移问题</p> <p>大家遵守共同的规则，我们自己对数据库的改动可以提交，同事对数据库的修改也可以及时知道。</p></li> <li><p>专为CI/CD设计，让持续集成与发布如此简单
之前反复迭代时，都是数据库手工升级并检查，使用Jenkins完成前后台升级，现在数据库升级也可以集成在流水线了！</p></li></ul> <h2 id="flyway命令"><a href="#flyway命令" class="header-anchor">#</a> Flyway命令</h2> <p>Flyway支持的7个命令：</p> <ul><li>Migrate（迁移）</li> <li>Clean（清理所有配置的对象）</li> <li>Info（显示迁移状态和细节）</li> <li>Validate（验证迁移规则）</li> <li>Undo（撤消最近的迁移）</li> <li>Baseline（建立基线）</li> <li>Repair（修复迁移历史表）</li></ul> <h2 id="spring-boot集成flyway"><a href="#spring-boot集成flyway" class="header-anchor">#</a> Spring Boot集成Flyway</h2> <h3 id="引入flyway依赖"><a href="#引入flyway依赖" class="header-anchor">#</a> 引入Flyway依赖</h3> <p>Flyway 几乎是零依赖，最低的要求是：</p> <ul><li>JDK 1.7+</li> <li>Jdbc Driver</li></ul> <p>首先，在Spring Boot项目的<code>pom.xml</code>文件中引入Flyway所需要的依赖。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.flywaydb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flyway-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="添加flyway配置"><a href="#添加flyway配置" class="header-anchor">#</a> 添加Flyway配置</h3> <p>然后，在application.yml 中写入 mysql 的配置及 Flyway 的相关配置(Flyway locations 默认读取当前项目下的 resources/db/migration 目录)这里展示flyway有关的配置。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">flyway</span><span class="token punctuation">:</span>
    <span class="token key atrule">locations</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> classpath<span class="token punctuation">:</span>flyway  <span class="token comment"># 用于扫描的迁移脚本目录</span>
    <span class="token key atrule">table</span><span class="token punctuation">:</span> t_flyway_history <span class="token comment"># 用于记录所有的版本变化记录</span>
</code></pre></div><p>Flyway也是约定大于配置的思想，以上Flyway的相关配置都可以不用写，可以说是零配置，它们都有默认值：</p> <ul><li>spring.flyway.locations: classpath:db/migration，用于扫描的迁移脚本目录</li> <li>spring.flyway.table: flyway_schema_history，用于记录所有的版本变化记录</li></ul> <p>Migrate 是指把数据库 schema 迁移到最新版本，是 flyway 工作流的核心功能， flyway 在 Migrate 时会检查 flyway_schema_history 表，如果不存在会创建 flyway_schema_history 表， flyway_schema_history 表主要用于记录版本变更历史以及 checksum 之类的。</p> <h3 id="创建迁移脚本"><a href="#创建迁移脚本" class="header-anchor">#</a> 创建迁移脚本</h3> <p>接下来，在<code>spring.flyway.locations</code>指定的目录下创建迁移脚本，若是初次使用，需要在resources目录下创建<code>spring.flyway.locations</code>指定的目录。其中，SQL 脚本命名规范如下：</p> <p><img src="/flyway/Flyway%E8%84%9A%E6%9C%AC%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83.png" alt="Flyway支持的数据库"></p> <ul><li>Prefix 前缀：V 代表版本迁移，U 代表撤销迁移，R 代表可重复迁移</li> <li>Version 版本号：版本号通常由 . 和整数组成</li> <li>Separator 分隔符：固定由两个下划线 __ 组成</li> <li>Description 描述：由下划线分隔的单词组成，用于描述本次迁移的目的</li> <li>Suffix 后缀：如果是 SQL 文件那么固定由 .sql 组成，如果是基于 Java 类则默认不需要后缀。</li></ul> <p>启动项目后，Flyway执行了数据库脚本，并自动创建<code>spring.flyway.table</code>指定的数据库表，用于记录所有版本演化和状态，同时，Flyway 会给脚本计算一个 checksum 保存在数据库中，用于在之后运行过程中对比 sql 文件是否有变化，如果发生了变化，则会报错，防止误修改脚本导致发生问题。其表结构如下(以 MySQL 为例)：</p> <p><img src="/flyway/Flyway%E8%AE%B0%E5%BD%95%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="Flyway记录表结构"></p> <h2 id="flyway迁移流程"><a href="#flyway迁移流程" class="header-anchor">#</a> Flyway迁移流程</h2> <p>1）Flyway 会扫描配置的脚本目录下的脚本文件；</p> <p>2）如果历史记录表不存在，则新建历史记录表；</p> <p>3）如果是一次性执行脚本（V），按版本号从小到大执行迁移脚本，与当前历史表中的版本号做对比，大于当前版本号的脚本才会被执行迁移；</p> <p>4）如果是可重复执行脚本（R），检查脚本是否有变动，有变动的可重复脚本才会被执行迁移；</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">LastUpdated:</span> <span class="time">4/12/2023, 11:34:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/mr-muggle/通用/DynamicDatasource.html">
        动态切换数据库dynamic-datasource
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#引言" title="引言" class="ant-anchor-link-title">引言</a></div><div class="ant-anchor-link"><a href="#flyway支持的数据库" title="Flyway支持的数据库" class="ant-anchor-link-title">Flyway支持的数据库</a></div><div class="ant-anchor-link"><a href="#使用flyway的好处" title="使用Flyway的好处" class="ant-anchor-link-title">使用Flyway的好处</a></div><div class="ant-anchor-link"><a href="#flyway命令" title="Flyway命令" class="ant-anchor-link-title">Flyway命令</a></div><div class="ant-anchor-link"><a href="#spring-boot集成flyway" title="Spring Boot集成Flyway" class="ant-anchor-link-title">Spring Boot集成Flyway</a><div class="ant-anchor-link"><a href="#引入flyway依赖" title="引入Flyway依赖" class="ant-anchor-link-title">引入Flyway依赖</a></div><div class="ant-anchor-link"><a href="#添加flyway配置" title="添加Flyway配置" class="ant-anchor-link-title">添加Flyway配置</a></div><div class="ant-anchor-link"><a href="#创建迁移脚本" title="创建迁移脚本" class="ant-anchor-link-title">创建迁移脚本</a></div></div><div class="ant-anchor-link"><a href="#flyway迁移流程" title="Flyway迁移流程" class="ant-anchor-link-title">Flyway迁移流程</a></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/mr-muggle/assets/js/app.03b0f33a.js" defer></script><script src="/mr-muggle/assets/js/2.c49e4524.js" defer></script><script src="/mr-muggle/assets/js/91.0823b62f.js" defer></script>
  </body>
</html>